\documentclass[12pt]{amsart}
\usepackage{fullpage,url,amssymb,enumerate,colonequals}

% \usepackage{amscd}   % for commutative diagrams
%\usepackage[all]{xy} % for complicated commutative diagrams, use pdf driver
\usepackage{mathrsfs} % for \mathscr (script letters)
% \usepackage{MnSymbol} % for dashed arrow

%\usepackage{mathabx}
%\usepackage{MnSymbol}
%\usepackage{extarrows}
%\usepackage{rotating}
%\usepackage{mathrsfs}
\usepackage{lscape}
\usepackage[all,cmtip]{xy}

% This is for resizeable \Sha
%\usepackage{natbib}
%\usepackage[OT2,T1]{fontenc}
%\DeclareSymbolFont{cyrletters}{OT2}{wncyr}{m}{n}
%\DeclareMathSymbol{\Sha}{\mathalpha}{cyrletters}{"58}


\usepackage{color}

\usepackage[
%       draft,
        colorlinks, citecolor=darkgreen,
        backref,
        pdfauthor={Nuno Freitas}, % add other authors
]{hyperref}
%\usepackage[alphabetic,backrefs,lite]{amsrefs} % for bibliography

\usepackage{array, booktabs, comment, multirow, todonotes}

% label and link to an elliptic curve /Q:
\newcommand{\lmfdbec}[3]{\href{http://www.lmfdb.org/EllipticCurve/Q/#1/#2/#3}{{\text{\rm#1.#2#3}}}}
% label and link to an elliptic curve isogeny class /Q:
\newcommand{\lmfdbeciso}[2]{\href{http://www.lmfdb.org/EllipticCurve/Q/#1/#2}{\text{\rm#1.#2}}}


\newcommand{\defi}[1]{\textsf{#1}} % for defined terms

\newcommand{\dashedarrow}{\dashrightarrow}

% Characters
\newcommand{\Aff}{\mathbb{A}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\Fbar}{{\overline{\F}}}
\newcommand{\G}{\mathbb{G}}
\newcommand{\Gm}{\mathbb{G}_{\mathrm{m}}}
\newcommand{\bbH}{\mathbb{H}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Qbar}{{\overline{\Q}}}
\newcommand{\Zhat}{{\hat{\Z}}}
\newcommand{\Ebar}{{\overline{E}}}
\newcommand{\Zbar}{{\overline{\Z}}}
\newcommand{\kbar}{{\overline{k}}}
\newcommand{\Kbar}{{\overline{K}}}
\newcommand{\rhobar}{{\overline{\rho}}}
\newcommand{\ksep}{{k^{\operatorname{sep}}}}

\newcommand{\frp}{{\mathfrak p}}

\newcommand{\Adeles}{\mathbf{A}}
\newcommand{\kk}{\mathbf{k}}

\newcommand{\mm}{\mathfrak{m}}

\newcommand{\eps}{\varepsilon}

\newcommand{\uom}{\underline{\omega}}

% bold characters
\newcommand{\boldf}{\mathbf{f}}
\newcommand{\boldl}{\ensuremath{\boldsymbol\ell}}
\newcommand{\boldL}{\mathbf{L}}
\newcommand{\boldr}{\mathbf{r}}
\newcommand{\boldw}{\mathbf{w}}
\newcommand{\boldzero}{\mathbf{0}}
\newcommand{\boldomega}{\ensuremath{\boldsymbol\omega}}


% mathcal characters
\newcommand{\calA}{\mathcal{A}}
\newcommand{\calB}{\mathcal{B}}
\newcommand{\calC}{\mathcal{C}}
\newcommand{\calD}{\mathcal{D}}
\newcommand{\calE}{\mathcal{E}}
\newcommand{\calF}{\mathcal{F}}
\newcommand{\calG}{\mathcal{G}}
\newcommand{\calH}{\mathcal{H}}
\newcommand{\calI}{\mathcal{I}}
\newcommand{\calJ}{\mathcal{J}}
\newcommand{\calK}{\mathcal{K}}
\newcommand{\calL}{\mathcal{L}}
\newcommand{\calM}{\mathcal{M}}
\newcommand{\calN}{\mathcal{N}}
\newcommand{\calO}{\mathcal{O}}
\newcommand{\calP}{\mathcal{P}}
\newcommand{\calQ}{\mathcal{Q}}
\newcommand{\calR}{\mathcal{R}}
\newcommand{\calS}{\mathcal{S}}
\newcommand{\calT}{\mathcal{T}}
\newcommand{\calU}{\mathcal{U}}
\newcommand{\calV}{\mathcal{V}}
\newcommand{\calW}{\mathcal{W}}
\newcommand{\calX}{\mathcal{X}}
\newcommand{\calY}{\mathcal{Y}}
\newcommand{\calZ}{\mathcal{Z}}

%mathfrak characters

\newcommand{\ff}{\mathfrak{f}}
\newcommand{\fm}{\mathfrak{m}}
\newcommand{\fM}{\mathfrak{M}}
\newcommand{\fp}{\mathfrak{p}}
\newcommand{\fP}{\mathfrak{P}}
\newcommand{\fq}{\mathfrak{q}}
\newcommand{\fN}{\mathfrak{N}}

\newcommand{\CC}{\mathscr{C}}
\newcommand{\FF}{\mathscr{F}}
\newcommand{\GG}{\mathscr{G}}
\newcommand{\II}{\mathscr{I}}
\newcommand{\JJ}{\mathscr{J}}
\newcommand{\LL}{\mathscr{L}}
\newcommand{\NN}{\mathscr{N}}
\newcommand{\OO}{\mathscr{O}}
\newcommand{\WW}{\mathscr{W}}
\newcommand{\XX}{\mathscr{X}}
\newcommand{\ZZ}{\mathscr{Z}}

% Math operators
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Br}{Br}
\DeclareMathOperator{\cd}{cd}
\DeclareMathOperator{\Card}{Card}
\DeclareMathOperator{\Char}{char}
\DeclareMathOperator{\Cl}{Cl}
\DeclareMathOperator{\codim}{codim}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Cor}{Cor}
\DeclareMathOperator{\divv}{div}
\DeclareMathOperator{\Div}{Div}
\DeclareMathOperator{\Det}{Det}
\DeclareMathOperator{\Dic}{Dic}

\DeclareMathOperator{\End}{End}
\newcommand{\END}{{\EE}\!nd}
\DeclareMathOperator{\Eq}{Eq}
\DeclareMathOperator{\Ext}{Ext}
\newcommand{\EXT}{{\E}\!xt}
\DeclareMathOperator{\Fix}{\tt Fix}
\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Frob}{Frob}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Gr}{Gr}
\DeclareMathOperator{\Hom}{Hom}
\newcommand{\HOM}{{\HH}\!om}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Ind}{Ind}
\DeclareMathOperator{\inv}{inv}
\DeclareMathOperator{\Jac}{Jac}
\DeclareMathOperator{\JL}{JL}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Lie}{Lie}
\DeclareMathOperator{\Log}{Log}
\DeclareMathOperator{\MakeDecentModel}{\tt MakeDecentModel}
\DeclareMathOperator{\nil}{nil}
\DeclareMathOperator{\Norm}{Norm}
\DeclareMathOperator{\NP}{NP}
\DeclareMathOperator{\Num}{Num}
\DeclareMathOperator{\odd}{odd}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\Pic}{Pic}
\DeclareMathOperator{\PIC}{\bf Pic}
\DeclareMathOperator{\Prob}{\bf P}
\DeclareMathOperator{\Proj}{Proj}
\DeclareMathOperator{\PROJ}{\bf Proj}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\rec}{rec}
\DeclareMathOperator{\re}{Re}
\DeclareMathOperator{\reg}{reg}
\DeclareMathOperator{\res}{res}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\rk}{rk}
\DeclareMathOperator{\scd}{scd}
\DeclareMathOperator{\Sel}{Sel}
\DeclareMathOperator{\Sp}{Sp}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\SPEC}{\bf Spec}
\DeclareMathOperator{\Spf}{Spf}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Sym}{Sym}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\T}{\mathbb{T}}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\tw}{tw}
\DeclareMathOperator{\trdeg}{tr deg}
\DeclareMathOperator{\WD}{WD}

% Categories
\newcommand{\Ab}{\operatorname{\bf Ab}}
\newcommand{\Groups}{\operatorname{\bf Groups}}
\newcommand{\Schemes}{\operatorname{\bf Schemes}}
\newcommand{\Sets}{\operatorname{\bf Sets}}

% Text subscripts, superscripts
\newcommand{\ab}{{\operatorname{ab}}}
\newcommand{\an}{{\operatorname{an}}}
\newcommand{\Az}{{\operatorname{Az}}}
\newcommand{\CS}{\operatorname{\bf CS}}
\newcommand{\et}{{\operatorname{et}}}
\newcommand{\ET}{{\operatorname{\bf \acute{E}t}}}
\newcommand{\fl}{{\operatorname{f\textcompwordmark l}}}
\newcommand{\good}{{\operatorname{good}}}
\newcommand{\op}{{\operatorname{op}}}
\newcommand{\perf}{{\operatorname{perf}}}
\newcommand{\red}{{\operatorname{red}}}
\newcommand{\regular}{{\operatorname{regular}}}
\newcommand{\sing}{{\operatorname{sing}}}
\newcommand{\smooth}{{\operatorname{smooth}}}
\newcommand{\tH}{{\operatorname{th}}}
\newcommand{\tors}{{\operatorname{tors}}}
\newcommand{\nontors}{{\operatorname{non-tors}}}
\newcommand{\unr}{{\operatorname{unr}}}
\newcommand{\Zar}{{\operatorname{Zar}}}
\newcommand{\ns}{{\operatorname{ns}}}
\renewcommand{\sp}{{\operatorname{sp}}}
\newcommand{\vv}{\upsilon}
\newcommand{\Cech}{\v{C}ech}
\newcommand{\E}{{\operatorname{\bf E}}}
\newcommand{\GalQ}{{\Gal}(\Qbar/\Q)}
\newcommand{\GL}{\operatorname{GL}}
\newcommand{\HH}{{\operatorname{H}}}
\newcommand{\HHcech}{{\check{\HH}}}
\newcommand{\HHat}{{\hat{\HH}}}
\newcommand{\M}{\operatorname{M}}
\newcommand{\PGL}{\operatorname{PGL}}
\newcommand{\PSL}{\operatorname{PSL}}
\newcommand{\SL}{\operatorname{SL}}

\newcommand{\del}{\partial}
\newcommand{\directsum}{\oplus} % binary direct sum
\newcommand{\Directsum}{\bigoplus} % direct sum of a collection
\newcommand{\injects}{\hookrightarrow}
\newcommand{\intersect}{\cap} % binary intersection
\newcommand{\Intersection}{\bigcap} % intersection of a collection
\newcommand{\isom}{\simeq}
\newcommand{\notdiv}{\nmid}
\newcommand{\surjects}{\twoheadrightarrow}
\newcommand{\tensor}{\otimes} % binary tensor product
\newcommand{\Tensor}{\bigotimes} % tensor product of a collection
\newcommand{\union}{\cup} % binary union
\newcommand{\Union}{\bigcup} % union of a collection

\newcommand{\Algorithm}{\textbf{Algorithm}\ }
\newcommand{\Subroutine}{\textbf{Subroutine}\ }

\newcommand{\isomto}{\overset{\sim}{\rightarrow}}
\newcommand{\isomfrom}{\overset{\sim}{\leftarrow}}
\newcommand{\leftexp}[2]{{\vphantom{#2}}^{#1}{#2}}
\newcommand{\rholog}{\rho \log}
\newcommand{\sigmaiota}{{\leftexp{\sigma}{\iota}}}
\newcommand{\sigmaphi}{{\leftexp{\sigma}{\phi}}}
\newcommand{\sigmatauphi}{{\leftexp{\sigma\tau}{\phi}}}
\newcommand{\tauphi}{{\leftexp{\tau}{\phi}}}
\newcommand{\To}{\longrightarrow}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}

% imported from JC's file
\DeclareMathOperator{\id}{id}
\def\w{\omega}
\def\r3{\sqrt{-3}}
\def\pibar{\overline{\pi}}
%\def\legover{\overwithdelims()}
\def\legendre#1#2{\displaystyle{\frac{#1}{#2}}}


\numberwithin{equation}{section}

%\newtheorem{theorem}{Theorem}
%\newtheorem{lemma}{Lemma}
%\newtheorem{corollary}{Corollary}
%\newtheorem{proposition}{Proposition}

%\theoremstyle{definition}
%\newtheorem{definition}[equation]{Definition}
%\newtheorem{question}[equation]{Question}
%\newtheorem{conjecture}[equation]{Conjecture}
%\newtheorem{example}[equation]{Example}
%\newtheorem{examples}[equation]{Examples}

%\theoremstyle{remark}
%\newtheorem{remark}[equation]{Remark}
%\newtheorem{remarks}[equation]{Remarks}


\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{question}[theorem]{Question}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{remarks}[theorem]{Remarks}


\definecolor{darkgreen}{rgb}{0,0.5,0}

\setlength{\parindent}{0mm}
\setlength{\parskip}{1ex plus 0.5ex}

\begin{document}

\title{On the symplectic type of mod 7 congruences between elliptic curves}

\author{John Cremona}
\address{Mathematics Institute,
         University of Warwick,
         Coventry CV4 7AL,
         United Kingdom}
\email{j.e.cremona@warwick.ac.uk}


\author{Nuno Freitas}
\address{Mathematics Institute,
         University of Warwick,
         Coventry CV4 7AL,
         United Kingdom}
\email{nunobfreitas@gmail.com}


\date{\today}

\keywords{Elliptic curves, Weil pairing, symplectic isomorphisms}
%\subjclass[2010]{Primary 11D41; Secondary 11G10, 11F80.}

\thanks{The second-named author is
supported by the
European Union's Horizon 2020 research and innovation programme under the Marie Sk\l{l}odowska-Curie grant 
agreement No.\ 747808}


\maketitle

\begin{abstract} 
We describe a procedure to determine the symplectic type of isomorphisms between the $7$-torsion modules of elliptic curves.
We apply it to classify all the congruences in LMFDB.
\end{abstract}

\section{Introduction}

Let $p \geq 3$ be a prime. Write $G_\Q = \Gal(\Qbar/\Q)$ for 
the absolute Galois group of $\Q$. 
Let $E$ and $E'$ be elliptic curves defined over $\Q$, and write 
$E[p]$ and $E'[p]$ for their $p$-torsion $G_\Q$-modules. 

Let $\phi : E[p] \to E'[p]$ be an isomorphismof $G_\Q$-modules.
There is an element $d(\phi) \in \F_p^\times$ such that
the Weil pairings~$e_{E,p}$ and~$e_{E',p}$ satisfy
\[
e_{E',p}(\phi(P), \phi(Q)) = e_{E,p}(P, Q)^{d(\phi)}
\]
for all $P, Q \in E[p]$.
We say that $\phi$ is a {\it symplectic isomorphism} or an
{\it anti-symplectic isomorphism}
if $d(\phi)$ is a square or a non-square modulo~$p$, 
respectively.

%Let us briefly mention our main sources of Galois isomorphisms $\phi : E[p] \to E'[p]$. 
%Any $\Q$-isogeny $h \; \colon \; E \to E'$ of degree~$n$ coprime to~$p$ restricts
%to an isomorphism of $G_\Q$-modules $\phi \; \colon \; E[p] \to E'[p]$. 
%In the case of $E$ and $E'$ being non-isogenous curves it is an important conjecture of 
%Frey and Mazur that there exists an absolute constant~$C$ such that if 
%a $G_\Q$-isomorphism $\phi \; \colon \; E[p] \to E'[p]$ exists then $p < C$. 
%Using Cremona's database \cite{lmfdb} together with \cite[Proposition~4]{KO} 
%we can find many pairs of non-isogenous curves with isomorphic $p$-torsion 
%for $p \leq 17$. Despite of the Frey-Mazur conjecture, we are often interested in considering 
%$\phi \; \colon \; E[p] \to E'[p]$ where $E'$ is a fixed elliptic curve, the existence of the curve $E$ is 
%hypothetical and the prime~$p$ is allowed to grow. This latter setting is of great interest for us 
%as it arises in the study of Diophantine equations, as explained 
%in Section~\ref{S:modularmethod}.

Given $G_\Q$-isomorphic $E[p]$ and~$E'[p]$,
it is possible that isomorphisms with both symplectic types exist; this occurs if and only if $E[p]$ admits 
an anti-symplectic automorphism. 
For example, take $p=5$ and $E$, $E'$ to be the curves 
with Cremona labels $11a1$ and $1342c2$, respectively; 
both have $5$-torsion module isomorphic to $\mu_5 \times \Z/5\Z$.
Now let $P,Q \in E[5]$ and $P',Q' \in E'[5]$ be basis such that $P$, $P'$ are defined over~$\Q$.
The map defined by $P \mapsto P'$ and $Q \mapsto n\cdot Q'$ (with $5 \nmid n$)
is a symplectic $G_\Q$-isomorphism if and only if $n$ is a square mod~$5$.  
Moreover, the automorphism $\alpha$ of $E[5]$ given by $\alpha(P) = P$ and $\alpha(Q) = 2Q$ 
is anti-symplectic because $2$ is not a square modulo~$5$.

However, despite of the example above, when a $G_\Q$-isomorphism $\phi : E[p] \simeq E'[p]$
exists, most of the time there is only one possible symplectic 
type for any such~$\phi$.
This is the case when the mod~$p$ representation 
$\rhobar_{E,p} : G_\Q \to \GL_2(\F_p)$ attached to~$E/\Q$ 
is irreducible and
also when it is reducible if $p \geq 7$; 
this follows from Corollary~3 and Proposition~2 in \cite{FKSym}.

It is then natural to consider triples $(E,E',p)$ where $E/\Q$ and $E'/\Q$ are elliptic curves with 
isomorphic $p$-torsion such that the $G_\Q$-modules 
isomorphisms $\phi \; : \; E[p] \rightarrow E'[p]$ are either all symplectic or all anti-symplectic. 
In this case, we will say that the {\it symplectic type} of $(E,E',p)$
is respectively symplectic or anti-symplectic.
In \cite{FKSym} the second author and Alain Kraus 
addressed the following problem.

\noindent {\bf Problem A:} 
Given a triple $(E,E',p)$ as above, how do we determine its symplectic type?

Problem A has an easy solution when 
$(E,E',p)$ arises from an isogeny $h \; \colon \; E \to E'$ of degree~$n$ coprime to~$p$. Indeed, 
in such cases $d(h|_{E[p]}) = n$ and the symplectic type of $(E,E',p)$ is 
symplectic if $n$ is a square mod~$p$ and anti-symplectic otherwise (see \cite[Corollary~1]{FKSym}). 

In general, given a triple $(E, E', p)$ as above, in principle,  one could compute 
the $p$-torsion fields of $E$ and $E'$, write down the Galois action on $E[p]$ and $E'[p]$ and check if they are symplectically or
anti-symplectically isomorphic. However, the degree of the $p$-torsion fields grows very fast with~$p$ making this method 
not practical already for $p = 5$. 

This computational problem is circumnvented by the methods 
in~\cite{FKSym}. Indeed, one of the main objectives of {\it loc. cit.} was to 
establish several {\it local symplectic criteria}, allowing
to determine the symplectic type of $(E,E',p)$
using only easy standard information about the local curves 
$E/\Q_\ell$ and $E'/\Q_\ell$ at a single prime $\ell \neq p$
and congruence conditions on~$p$. Furthermore, the authors also proved that if the symplectic type of~$(E,E',p)$ is encoded in local information at a single prime $\ell \neq p$, 
then their local criteria will successfuly determine it. 
However, there are cases where the local methods are insufficient, but this can occur only when $\rhobar_{E,p}$ has image the normalizar of a Cartan subgroup; 
see \cite[Proposition~12]{FKSym} for an example.  

The main objective of this paper is to give a complete resolution of Problem~A when $p=7$ by describing a practical procedure that works independently of the type of 
image of $\rhobar_{E,p}$.

We also implemented in {\tt Magma} code the method from this paper together with those from~\cite{FKSym}. We have used it
to classify the symplectic types 
of congruences between curves available at LMFDB \cite{lmfdb}; the results obtained are described in Section~\ref{S:statistics}


We finish this introduction with a discussion of why the case $p=7$ is particularly interesting. 

Recall that the modular curves $X_E(p)$ and $X_E^-(p)$ parameterize, respectively, elliptic curves with $p$-torsion modules symplectically and anti-symplectically isomorphic to~$E[p]$; thus triples $(E,E',p)$ as above give rise to $\Q$-points on them. The modular curves $X(p)$ for $p=3,5$ have genus~0, equations for $X_E(p)$ are well known and from them we can obtain infinitely many triples $(E,E',p)$ with each symplectic type.


The Frey-Mazur conjecture states there is a constant $C \geq 18$ such that, if $E/\Q$ and $E'/\Q$ satisfy $E[p] \simeq E'[p]$ as $G_\Q$-modules for some prime $p > C$, then $E$ and $E'$ are $\Q$-isogenous. In view of this conjecture, any~$(E,E',p)$ with $p > C$ arises from an isogeny, hence its symplectic type is easy 
to determine. On the other hand, as mentioned above, if no local symplectic criterion from \cite{FKSym} applies to~$(E,E',p)$
then the image of $\rhobar_{E,p}$ is the normalizer of a Cartan subgroup. In such case, Serre's uniformity conjecture predicts that either both $E$ and $E'$ have CM or $p \le 11$.
Since the CM curves are amenable to the local methods, 
we are left with the cases $p=7,11$ for which there are interesting congruences whose symplectic type cannot be determined by the methods in~\cite{FKSym}. 
The modular curves $X(7)$ and $X(11)$ have genus 3 and 26, respectively, and, in practice, we find plenty more mod~$7$ than mod~$11$ congruences, making $p=7$ the most interesting case to complete the solution of Problem~A. 


\begin{remark}
A similar method to the one in this paper but using the equations of $X_E(11)$ given by Fisher~\cite{Fisher} 
could in principle be applied to Problem~A for $p=11$. 
\end{remark}

\section{The case of image equal to normalizer of Cartan}

Let $p$ be a prime. Fix $\zeta_p. \in \Qbar$ a $p$-th primitive root of unity.
Given an elliptic curve $E$ over a number field $K \subset \Qbar$ 
write $E[p]$ for its $p$-torsion $G_K$-module. Let $e_{E,p}$ denote 
the Weil pairing in $E[p]$
and $\rhobar_{E,p} : G_K \to \GL_2(\F_p)$ the Galois representation
arising from $E[p]$.

When $\rhobar_{E,p}$ has image $N \subset \GL_2(\F_p)$ the 
normalizer of a Cartan subgroup~$C$ it defines a non-trivial 
quadratic character
\[
 \eps \; : G_K \to N \twoheadrightarrow N/C \simeq \{\pm 1 \}
\]
and we write $K(\sqrt{d})$ for the quadratic extension cut 
out by~$\eps$.

\begin{theorem} Let $p > 2$ be a prime. Let $E/K$ be an elliptic curve 
over a number field $K$. Assume that $\rhobar_{E,p}$ has image~$N \supset C$ 
as above. Let $E^d$ be the quadratic twist of $E$ by~$d$.

Then, $E[p]$ and $E^d[p]$ are isomorphic $G_K$-modules. Moreover, 
any such isomorphism is symplectic if and only if $C$ is split and $p \equiv 1 \pmod{4}$ or 
$C$ is non-split and $p \equiv 3 \pmod{4}$ and anti-symplectic 
otherwise. 
\end{theorem}

\begin{proof} We first prove that $E[p] \simeq E^d[p]$ as $G_K$-modules. 
Note that $\rhobar_{{E^d}, p} = \rhobar_{E, p} \otimes \eps$ hence,
for all $\sigma \in G_K$, we have 
\[\Tr \rhobar_{{E^d},p}(\sigma) = \eps(\sigma) \cdot \Tr \rhobar_{E,p}(\sigma).\]

Note that, if $\eps(\sigma) = -1$ then $\rhobar_{E,p}(\sigma) \in N\backslash C$ and $\Tr \rhobar_{E,p}(\sigma) = 0$, so also $\Tr \rhobar_{E^d,p}(\sigma) = 0$;
therefore, $\Tr \rhobar_{E,p}(\sigma) = \Tr \rhobar_{E^d,p}(\sigma)$ 
for all $\sigma \in G_K$. Since these representations are irreducible and have
the same traces it follows they are isomorphic.

From the hypothesis on the image of $\rhobar_{E,p}$ we can 
choose a basis $P_1, P_2$ of $E[p]$ such that $\rhobar_{E,p}$ has image 
the subgroup of $\GL_2(\F_p)$ given by 
\[
\left\{ 
\begin{pmatrix}
a & b\delta \\
b & a
\end{pmatrix}, 
\begin{pmatrix}
a & b\delta \\
-b & -a
\end{pmatrix}  \; : a, b \in \F_p, \; a^2 - \delta b^2 \neq 0 \right\},
\]
where $\delta \in \F_p^*$ is a (fixed) square if $C$ is split and 
a non-square if $C$ is non-split. Furthermore, for $\sigma \in G_K$, we have 
\[
 \rhobar_{E,p}(\sigma) = \begin{cases} 
                            \begin{pmatrix}
                            a & b\delta \\
                            b & a
                            \end{pmatrix} \quad \text{ if } \eps(\sigma) = 1,  \\
\begin{pmatrix}
a & b\delta \\
-b & -a
\end{pmatrix} \quad \text{ if } \eps(\sigma) = -1.  \\
\end{cases}\]
Fix $\tau \in G_K$ such that 
\[
 \rhobar_{E,p}(\tau) =  \begin{pmatrix}
                            1 & 0 \\
                            0 & -1
                            \end{pmatrix},
\]
so that  $\tau(P_1) = P_1$, $\tau(P_2) = -P_2$ and 
$\rhobar_{E,p}(G_K) = N = \langle C,\rhobar_{E,p}(\tau) \rangle$.


Let $\tw : E[p](\Qbar) \to E^d[p](\Qbar)$ be the map on $p$-torsion points induced by the isomorphism defined over $K(\sqrt{d})$. On short Weierstrass models, 
it is given by $\tw(x,y) = (x,y\sqrt{d})$ and a direct calculation shows 
that
\begin{equation} \label{E:eps}
 \tw(\sigma(P)) = \eps(\sigma)\cdot\sigma(\tw(P)) \quad \text{ for all } \sigma \in G_K 
 \text{ and all } P \in E[P]. 
 \end{equation}
We now consider the linear
map $\phi : E[p] \to E^d[p]$ defined on the basis by
\[
 \phi(P_1) = \tw (P_2) \quad \text{ and } \quad   \phi(P_2) = \delta \tw (P_1)
\]
and will 
show it is $G_K$-equivariant, i.e. $\sigma(\phi(P)) = \phi(\sigma(P))$ for all $\sigma \in G_K$ and $P \in E[P]$. Write $P_i = (x_i,y_i)$ and note that $\eps(\tau) = -1$. We have
\[
 \tau(\phi(P_1)) = \tau(\tw(P_2)) = -\tw(\tau(P_2)) = -\tw (-P_2) = \phi(P_1) = \phi(\tau(P_1)),
\]
where in the second inequality we used~\eqref{E:eps} and, moreover,
\[
 \tau(\phi(P_2)) = \tau(\delta \tw(P_1)) = -\delta \tw(\tau(P_1)) = 
  -\delta \tw(P_1) = -\phi (P_2) = \phi(\tau(P_2)).
\]
Recall that for $\sigma \in G_K$ such that $\rhobar_{E,p}(\sigma) \in C$, we have
$\eps(\sigma) = 1$ and
\[
 \rhobar_{E,p}(\sigma) =  \begin{pmatrix}
                            a & b\delta \\
                            b & a
                            \end{pmatrix}.
\]
Therefore, equation~\eqref{E:eps} 
gives $\tw(\sigma(P_i)) = \sigma(\tw(P_i))$ and we have
\[
 \sigma(\phi(P_1)) = \sigma(\tw(P_2)) = \tw (\sigma (P_2)) 
 = \tw (\delta b P_1 + a P_2) = \delta b \tw (P_1) + a\tw(P_2) = b \phi(P_2) + a \phi(P_1)
\]
and
\[
 \sigma(\phi(P_2)) = \delta \sigma(\tw(P_1)) = \delta \tw (\sigma (P_1)) 
 = \delta \tw (a P_1 + b P_2) = a \phi(P_2) + b \delta \phi(P_1) = \phi(\sigma(P_2)),
\]
as desired. Finally, we note that 
\[
 e_{E^d,p}(\phi(P_1),\phi(P_2)) = e_{E^d,p}(\tw (P_2),\delta \tw(P_1)) 
 =  e_{E^d,p}(\tw (P_1), \tw (P_2))^{-\delta} =  e_{E,p}(P_1,P_2)^{-\delta}, 
 \]
where the last equality holds since $\tw$ preserves the Weil pairing.
Thus $\phi$ is symplectic if and only if $(-\delta/p) = 1$.
\end{proof}

\section{The case of reducible image}

Let $B \subset \GL_2(\F_p)$ be the Borel subgroup, i.e. the upper triangular matrices. Let $H \subset B$ be a subgroup of order divisible by~$p$. 
We can write~$H = D\cdot U$ where $D \subset B$ is a subgroup of diagonal matrices and 
$U$ is cyclic generated by $\left(\begin{smallmatrix}
                            1 & 1 \\
                            0 & 1
                            \end{smallmatrix} \right)$.   
Morever, $U$ a normal subgroup of~$H$ 
and we write $\pi : H \to H/U \simeq D$ for the quotient map.

\begin{proposition} \label{P:inner}
Let $H = D \cdot U \subset B$ and $\pi$ be as above. 
Let $\phi$ be an automorphism of~$H$. Assume that  
$\pi(x) = \pi(\phi(x))$ for all $x \in H$. 

Then $\phi$ is given by conjugation in $B$, i.e. there is $A \in B$ such that $\phi(x) = AxA^{-1}$. 
\end{proposition}
\begin{proof}
Let $x \in H$ and write it as $x = du$ with $d \in D, u \in U$.
Note that $U$ is the unique normal subgroup with order~$p$, so 
$\phi(U) = U$ and $\phi(D)=D$ for all $\phi \in \Aut H$.
By hypothesis, we have 
\[
 \pi(x) = \pi(\phi(x)) = \pi(\phi(d))\pi(\phi(u)) \iff dU = \phi(d)U
 \iff d\phi(d)^{-1} \in U.
\]
Since $d, \phi(d) \in D$ we have $d\phi(d)^{-1} \in D \cap U = \{ I_2\}$ therefore $d\phi(d)^{-1} = I_2$, where $I_2$ is the identity in $\GL_2(\F_p)$.
Thus $d = \phi(d)$ and we conclude that any $\phi$ 
as in the statement is the same as an automorphism of~$U$ (extended to~$H$ by $\phi(d)=d$ for all $d\in D$). 

Write $N_B(U)$  for the normalizer of $U$ in $B$ and $C_B(U)$ for its centralizer. 
We have $N_B(U) = B$ 
and $C_B(U)$ are the matrices of the form $\left(\begin{smallmatrix}
                            \lambda & b \\
                            0 & \lambda
                            \end{smallmatrix} \right)$
with $\lambda \neq 0$. Thus $\# N_B(U)/C_B(U) = p-1$. 
Since  we also have 
\[
 N_B(U)/C_B(U) \hookrightarrow \Aut U \simeq \F_p^*
\]
it follows that $\Aut U \simeq N_B(U)/C_B(U)$, as desired.
\end{proof}

\begin{proposition} \label{P:fieldF}
Let $p > 2$ be a prime. Let $E/K$ be an elliptic curve such that 
$\rhobar_{E,p}$ is reducible. Assume there is an element of order~$p$ 
in the image of~$\rhobar_{E,p}$. 

Then, there is a field $F \supset K$ such that $[F : K] = p$ and $E$ aquires a 
second isogeny over~$F$.
\end{proposition}
\begin{proof} We can choose a basis of $E[p]$ where
\[
\rhobar_{E,p} =  \begin{pmatrix}
                            \chi& h \\
                            0 & \chi'
                            \end{pmatrix} \]

Let $H$ be the set of elements $\sigma \in  G_K$ such 
that $h(\sigma) = 0$. Since $\rhobar_{E,p}$ is a homomorphism it follows 
that $H$ is a subgroup of $G_K$. 
We let $F \subset K(E[p])$ to be the field fixed by $H$.
Since there is an element of order~$p$ in the image 
we conclude that $[F : K] =p$.
\end{proof}


\begin{theorem} 
Let $p > 2$ be a prime. Let $E_1, E_2$ be elliptic curves 
over~$K$ such that 
\begin{itemize}
 \item[(i)] $\rhobar_{E_1,p}^{ss} \simeq \rhobar_{E_2,p}^{ss} \simeq \chi \oplus \chi'$,  where $\chi, \chi' : G_K \to \F_p^*$ are characters;
 \item[(ii)] both $\rhobar_{E_1,p}$ and $\rhobar_{E_2,p}$ have an element of
 order~$p$ in the image.
\end{itemize}
If $F_1 \simeq F_2$ then $\rhobar_{E_1,p} \simeq \rhobar_{E_2,p}$ 
after replacing $E_2$ by a $p$-isogenous curve if necessary, 
where $F_i/K$ is a degree~$p$ extension where $E_i$ aquires a second isogeny
as given by Proposition~\ref{P:fieldF}.


\end{theorem}
\begin{proof} From (i) it follows that $\rhobar_{E_i,p}$ is reducible and that, after replacing $E_2$ by a $p$-isogenous curve if necessary (to swap 
$\chi$ with $\chi'$), 
we have 
\[
\rhobar_{E_i,p} =  \begin{pmatrix}
                            \chi & h_i \\
                            0 & \chi'
                            \end{pmatrix} \quad \text{ with } \quad  h_i : G_K \to \F_p.  
\]
Let $L$ be the field cut out 
by $\chi \oplus \chi'$. 
It follows from (ii) that $h_i|_{G_L} \neq 0$ 
hence the matrix $\left(\begin{smallmatrix}
                            1 & 1 \\
                            0 & 1
                            \end{smallmatrix} \right)$  
is in the image of $\rhobar_{E_i,p}$ for $i=1,2$.
                            
Write $K_i = K(E_i[p])$. 
We have $[K_i : K] = [K_i : L][L : K] = p [L : K]$. 
Since the degree $[L : K]$ divides $(p-1)^2$ it is coprime 
to $p = [F_i : K]$ therefore we have $K_i = L F_i$.

Suppose $F_1 \simeq F_2$. Since $K_1$ is Galois, we have $F_2 \subset K_1$ and therefore $K_p := K_1 = K_2$ is the field cut out by both
$\rhobar_{E_1,p}$ and $\rhobar_{E_2,p}$.
Write $G = \Gal(K_p / K)$. 

From now on we think of $\rhobar_{E_i,p}$ as an injective representation of~$G$. Note that the images of $\rhobar_{E_1,p}$ and $\rhobar_{E_2,p}$
is the same subgroup~$H$ of the Borel.

All the elments in $H$ are of the form $\rhobar_{E_2,p}(\sigma)$ for $\sigma \in G$, so we can consider the map $\phi = \rhobar_{E_1,p} \circ \rhobar_{E_2,p}^{-1} : H \to H$. It is an automorphism of~$H = D\cdot U$ satisfying the hypothesis of Proposition~\ref{P:inner}, where $D$ are 
the matrices $\left(\begin{smallmatrix}
                            \chi & 0 \\
                            0 & \chi'
                            \end{smallmatrix} \right)$.  
Then, $\phi$ is given by conjugation, that is
\[
 \phi(\rhobar_{E_2,p}(\sigma)) = A \rhobar_{E_2,p}(\sigma) A^{-1}.
\]
Since we also have
\[ 
\phi(\rhobar_{E_2,p}(\sigma)) 
=  \rhobar_{E_1,p} \circ \rhobar_{E_2,p}^{-1}(\rhobar_{E_2,p}(\sigma)) = \rhobar_{E_1,p}(\sigma)
\]
we conclude that $\rhobar_{E_1,p}(\sigma) = A \rhobar_{E_2,p}(\sigma) A^{-1}$, as desired.
\end{proof}



\section{Congruences in the database}\label{S:statistics}

blah blah

\section{Mod-$7$ isomorphisms between elliptic curves with
  $j$-invariant~$0$}
We show that for every elliptic curve~$E$ with $j(E)=0$, there is a
non-trivial sextic twist of~$E$ which has symplectically isomorphic
mod-$7$ Galois representation.

\subsection{Introduction}
In \cite{Halberstadt-Kraus-XE7}, Halberstadt and Kraus give an
explicit model for the modular curve $X_E(7)$, for any elliptic curve
$E$ defined over a field~$K$ of characteristic not equal to $2$, $3$
or~$7$. The $K$-rational points on $X_E(7)$ parametrise pairs
$(E',\phi)$ where $E'$ is an elliptic curve defined over~$K$ and
$\phi:E[7]\to E'[7]$ is an isomorphism of symplectic $G_K$-modules.
Here the symplectic structure on $E[7]$ is given by the Weil pairing,
and we identify two such isomorphisms~$\phi$ when one is a scalar
multiple of the other.

The model for $X_E(7)$ given in \cite{Halberstadt-Kraus-XE7} is a
plane quartic curve (a twist of $X(7)$, which has the classical Klein
quartic as a model over~$\Q$) given by an explicit ternary quartic
form~$F_{a,b}(X,Y,Z)$ in $\Z[a,b][X,Y,Z]$ where $E$ has equation
$Y^2=X^3+aX+b$.  The $24$ flexes on $X_E(7)$ are the cusps; in other
words they are the poles of the degree~$168$ map to the $j$-line, $j:
X_E(7)\to X(1)$.  The $28$ bitangents intersect $X_E(7)$ at the 56
points above $j=0$: these are the intersection points of $X_E(7)$ and
the curve of degree~$14$ defined by a covariant of~$F_{a,b}$.

The base point $P_E=[0:1:0]\in X_E(7)(K)$ corresponds to the pair
$(E,\id)$.  The tangent line to $X_E(7)$ at~$P_E$ is $Z=0$.  In
general, when $a\not=0$, this line intersects $X_E(7)$ in two further
distinct points $P_{\pm}=[\pm\sqrt{-3a}:a:0]$ which are rational if
and only if $-3a\in K^{*2}$.  When this holds, the isomorphic curves
$E'$ may be found using the two parametrized families in the earlier
paper \cite{Halberstadt-Kraus-YE7} of Halberstadt and Kraus.  However,
these parametrization fail when $a=0$, that is for curves with
$j$-invariant~$0$.  The purpose of this note is to fill this gap.

When $a=0$, the second point of intersection of the bitangent $Z=0$
with $X_E(7)$, in addition to $P_E=[0:1:0]$, is $P_0=[1:0:0]$.  In
what follows we do not need to use the curve $X_E(7)$, but it is the
existence of this second rational point on $X_E(7)$ whenever $j(E)=0$
which led us to the result here.

\subsection{Statement of result}
Every elliptic curve with $j=0$ has a model of the form
$E_b:\ Y^2=X^3+b$ with $b$ nonzero, and the isomorphism class of $E_b$
depends only on $b$ modulo $6$th powers.  Any two such curves are
sextic twists of each other: the sextic twist of $E_b$ by $u$ is
$E_{bu}$, which is isomorphic to $E_b$ if and only if $u$ is a $6$th
power.  Our result is the following:

\begin{theorem}
For every $b\not=0$, the elliptic curves $E_b$ and $E_{-28/b}$ have
symplectically isomorphic mod-$7$ Galois representations.
\end{theorem}

\begin{remark}
The same method can be used to show that $E_b$ and $E_{-27b}$ have
antisymplectically isomorphic Galois representations.  However this is
more easily seen by noting that these curves are $3$-isogenous; since
$3$ is a non-quadratic residue of~$7$, a $3$-isogeny between them
induces an antisymplectic isomorphism between their mod-$7$ torsion
modules.  In case $-3$ is a square, these curves are even isomorphic,
and the $3$-isogeny is the endomorphism $\pm\r3$, while in
general the two curves are quadratic twists.
\end{remark}

For simplicity of notation we take the base field to be $\Q$.  Little
change would be required in what follows if $\Q$ were to be replaced
by any field of characteristic different from~$2$, $3$ or $7$ in which
$-3$ is not a square.  In case $-3$ is a square there is some
simplification, and the result still holds.

\subsection{Proof: preliminaries}
Let $K=\Q(\r3)=\Q(\w)$ where $\w$ satisfies
$\w^2+\w+1=0$, so that $\w$ is a primitive $3$rd root of
unity and $-\w$ a primitive $6$th root of unity.  The elliptic
curves $E_b$ have CM by the maximal order $\OO_K=\Z[\w]$ in which
$7$ splits as $7=\pi\pibar$ where $\pi=3\w+2$.  Set
$\r3=2w+1$ (to fix the sign).  We denote the nontrivial
automorphism of $K/\Q$ by $x\mapsto x'$.

Fix $b\in\Q^*$ defining the elliptic curve $E_b: Y^2=X^3+b$.  The
$2$-dimensional $\F_7$-vector space $E_b[7]$ has two $K$-rational
one-dimensional subspaces, namely the kernels of the endomorphisms
$[\pi]$ and $[\pibar]$, which we make explicit.

Define
\begin{align}
\alpha&=4b/\pibar,\\
\beta=\alpha+b&=-\w^2\r3^3b/\pibar,\quad\text{and}\\
\gamma&=-4\r3^3b/\pibar = -\r3^3\alpha = 4\w\beta.
\end{align}
Then for any choice of roots, the point $(\alpha^{1/3},\beta^{1/2})\in
E_b(\Qbar)$.  We fix one $6$th root $\gamma^{1/6}$ once and for all
and set
\begin{align}
\alpha^{1/3} &= \gamma^{1/3}/\r3,\\
\beta^{1/2} &= \gamma^{1/2}\w/2
\end{align}
(with $\gamma^{1/3}=(\gamma^{1/6})^2$ and $\gamma^{1/2}=(\gamma^{1/6})^3$).  Let
$P=(\alpha^{1/3},\beta^{1/2})\in E_b(\Qbar)$.

Computing the $7$-division polynomial of~$E_b$, we find that over
$\Q(b)$ (treating $b$ as an indeterminate) it has factors $X^3-\alpha$
and $X^3-\alpha'$, the remaining factor of degree~$18$ being
irreducible.  It follows that $P$ and the conjugate point
$P'=(\alpha'^{1/3},\beta'^{1/2})$ have order~$7$.  Also, the multiples
$kP$ for $1\le k\le6$ all have $x(kP)^3=\alpha$ (this can be checked
by direct calculation, or by observing that $x(2P)^3=\alpha'$ yields a
contradiction after repeating three times since $8P=P$).

Thus the $7$-division field is
$L=K(E_b[7])=K(P,P')=K(\gamma^{1/6},\gamma'^{1/6})$.

\begin{lemma}In all cases, $\gamma$ and~$\gamma'$ are independent in
  $K^*/K^*{}^2$.  They are independent in $K^*/K^*{}^3$ unless
  $b=2\cdot7^2\cdot c^3$ with~$c\in\Q^*{}^3$, in which case
  $\gamma\gamma'=(-42c)^3$ and they generate a subgroup of $K^*/K^*{}^3$
  of order~$3$.

In the first case we have $\Gal(L/K)\cong(\Z/6\Z)^2$.  In the second
case, $\Gal(L/K)\cong(\Z/6\Z)\times(\Z/2\Z)$.
\end{lemma}
\begin{proof}
Elementary.
\end{proof}
Note that $b=98c^3\implies -28/b=98(-7c)^3$, so the situation is
symmetric between $E_b$ and $E_{-28/b}$.  In this case, the curves
$E_b$ and $E_{-28/b}$ are not just sextic twists but quadratic twists
by $-7$, since $-28/b^2=(-7)^3/c^6$.

\subsection{Proof: generic case}

To start with, we assume that we are not in the special case, so that
$\Gal(L/K)\cong(\Z/6\Z)^2$.  We will define generating
automorphisms~$\sigma_1$, $\sigma_2\in\Gal(L/K)$, each of order~$6$, together
with an automorphism~$\tau$ of order~$2$ in $\Gal(L/\Q)$ such that
$\Gal(L/\Q)=\left<\sigma_1,\sigma_2,\tau\right>$.

Fix one value of $\gamma^{1/6}$ arbitrarily.  Let $\tau\in\Gal(L/\Q)$
be an element of order~$2$ restricting to the non-trivial element of
$\Gal(K/\Q)$.  Then $(\tau(\gamma^{1/6}))^6=\tau(\gamma)=\gamma'$, so
we may fix the value of $\gamma'^{1/6}$ by setting
$\gamma'^{1/6}=\tau(\gamma)$.  Now by independence of $\gamma^{1/6}$
and $\gamma'^{1/6}$ there exists $\sigma_1\in\Gal(L/K)$ fixing
$\gamma'^{1/6}$ and mapping $\gamma^{1/6}\mapsto-w\gamma^{1/6}$ (recall
that $-w$ is a primitive $6$th root of unity) and also
$\sigma_2\in\Gal(L/K)$ fixing $\gamma^{1/6}$ and mapping
$\gamma'^{1/6}\mapsto-w^2\gamma'^{1/6}$.

Both $\sigma_1$ and~$\sigma_2$ multiply $(\gamma/\gamma')^{1/6}$ by
the same $6$th root of unity, $-w$.  Note that
$\gamma/\gamma'=-\pi/\pibar$; one may check that
$K((\gamma/\gamma')^{1/6})=K(\zeta_7)$, and that both $\sigma_1$ and
$\sigma_2$ map $\zeta_7$ to $\zeta_7^3$.  (The image must be either
$\zeta_7^3$ or $\zeta_7^5$ since $3$ and $5$ are the primitive roots
modulo~$7$.)

Recall that $P=(\alpha^{1/3},\beta^{1/2})\in E_b(K(\gamma^{1/6}))$ is
fixed by our choice of $\gamma^{1/6}$.  We similarly have
$P'=(\alpha'^{1/3},\beta'^{1/2})\in E_b(K(\gamma'^{1/6}))$, and~$\tau$
interchanges these.  Hence we have
\[
   \rho_{E_b,7}(\tau) = \begin{pmatrix}0&1\\1&0   \end{pmatrix}.
\]


Now $\sigma_1$ fixes~$P'$, while one may see that $\sigma_1(P)=3P$
(for example the standard formulas for adding points show that
$-2P=(w^{-5}\alpha^{1/3},\beta^{1/2})=\sigma_1^5(P)$); this also
follows from the action on the $7$th roots of unity noted above, which
implies that the determinant of the matrix giving the action of
$\sigma_1$ on $\left<P,P'\right>$ is $3\pmod7$.  This matrix is
therefore
\[
   \rho_{E_b,7}(\sigma_1) = \begin{pmatrix}3&0\\0&1   \end{pmatrix},
\]
and similarly
\[
   \rho_{E_b,7}(\sigma_2) = \begin{pmatrix}1&0\\0&3   \end{pmatrix}.
\]

Now we consider the effect of twisting~$E_b$ by $u=-28/b^2$.
Replacing $b$ by $ub=-28/b$ changes $\gamma$ into $(2\r3)^6/\gamma'$.
In fact we started out by looking for a sextic twist~$u$ which induces
an isomorphism on the $7$-torsion modules, which must have the effect
of replacing $\gamma$ by $\gamma^{\pm1}$ or~$\gamma'^{\pm1}$, modulo
$6$th powers.  The only solutions with $u\in\Q^*$ are $u=-27$ and
$u=-28/b^2$.

Hence the twist leaves the $7$-division field
$K(\gamma^{1/6},\gamma'^{1/6})$ unchanged, which is certainly
necessary.

The twisting map~$\tw$ takes $(x,y)\in E_b$ to $(u^{1/3}x,u^{1/2}y)\in
E_{bu}$.  Again we need to fix the roots.  We set
$u^{1/6}=2\r3/(\gamma^{1/6}\gamma'^{1/6})$, then
$u^{1/3}=-12/(\gamma^{1/3}\gamma'^{1/3})$ and
$u^{1/2}=8\r3^3/(\gamma^{1/2}\gamma'^{1/2})$.  Hence
\[
 \tw(P) = (u^{1/3}\alpha^{1/3},u^{1/2}\alpha^{1/2}) =
(4\r3/\gamma'^{1/3},-4w\r3^3/\gamma'^{1/2}),
\]
which is fixed by~$\sigma_1$ and taken to $3$ times itself
by~$\sigma_2$.  Similarly, $\sigma_2$ fixes $\tw(P')$ and
multiples~$\tw(P)$ by~$3$.

Now $\tau$ fixes $u^{1/3}$ and negates $u^{1/2}$. A simple calculation
then gives $\tau(\tw(P)) = -\tw(P')$.

Now define $\phi: E_b[7] \to E_{bu}[7]$ by $P\mapsto\tw(P')$,
$P'\mapsto-\tw(P)$.  Then $\phi$ commutes with the action of
$\sigma_1$, $\sigma_2$ and~$\tau$, so is an isomorphism of
$G_\Q$-modules.  It is also symplectic:  denoting the Weil pairing by
$e_7$ we have
\[
e_7(\phi(P),\phi(P')) = e_7(\tw(P'),-\tw(P)) = e_7(P',-P) =
e_7(P',P)^{-1} = e_7(P,P'),
\]
where we have used the fact that $\tw$, being an isomorphism defined
over $\overline{\Q}$ preserves the Weil pairing.

This completes the proof that $E_b[7]$ and $E_{-28/b}[7]$ are
isomorphic as symplectic $G_{\Q}$-modules in the case where $b\notin
2\cdot7^2\cdot \Q^*{}^3$.


\begin{remark}
The fixed field of $\sigma_1\sigma_2$ is $K(\zeta_7)=\Q(\zeta_{21})$.
One may check that this is the field of definition of the full set of
$7$-isogenies of $E_b$: this is consistent with $\sigma_1\sigma_2$
having trivial image in $\PGL(2,\F_7)$.
\end{remark}

\subsection{Proof: special case}

Now we take $u=-7^3$ so the sextic twist by~$u$ is just the quadratic
twist by $-7$.  We fix $\gamma^{1/6}$ and $\gamma'^{1/6}$ with
$\tau(\gamma^{1/6})=\gamma'^{1/6}$ as before.

Since $\gamma\gamma'\in\Q^*{}^3$, any $\sigma\in\Gal(L/K)$
maps~$\gamma^{1/6}$ to $\zeta_6^r\gamma^{1/6}$ and~$\gamma'^{1/6}$ to
$\zeta_6^s\gamma^{1/6}$ where $(r,s)\in(\Z/6\Z)^2$ satisfy
$r+s\equiv0\pmod3$.  (Here $\zeta_6=-w$.) So $\Gal(L/K)$ is isomorphic
to a subgroup of index~$3$ in~$(\Z/6\Z)^2$.  As generators we may take
$\sigma_1$ of order~$6$ mapping to $(1,-1)$, and $\sigma_2$ of
order~$2$ mapping to $(0,3)$.  Then the computations carried out for
the generic case give
\[
   \rho_{E_b,7}(\sigma_1) = \begin{pmatrix}3&0\\0&3   \end{pmatrix},
\]
and
\[
   \rho_{E_b,7}(\sigma_2) = \begin{pmatrix}1&0\\0&-1   \end{pmatrix}.
\]

The twist map takes $(x,y)\mapsto(-7x,\sqrt{-7}^3y)$ and we find that
all three of $\sigma_1$, $\sigma_2$ and~$\tau$ map $\sqrt{-7}$ to
$-\sqrt{-7}$.  For this one may use the classical formula
\[
   \sqrt{-7} = \sum_{k\pmod7}\legendre{k}{7}\zeta_7^k.
\]
The same definition of~$\phi$ as in the generic case gives a
symplectic Galois isomorphism here, completing the proof.

 
\begin{thebibliography}{999}


\bibitem{FKSym} N.\ Freitas and A.\ Kraus,
{\em On the symplectic type of isomorphisms of the $p$-torsion of elliptic curves}, Preprint

\bibitem{lmfdb} The {LMFDB Collaboration},
{\em The L-functions and Modular Forms Database}, \\
\url{http://www.lmfdb.org}, 2013.

\bibitem{Fisher} T.\ Fisher,
{\em On families of $7$ and $11$-congruent elliptic curves}, 
LMS J.\ Comput.\ Math.\ {\bf 17} (2014), no. 1, 536--564.

\bibitem{FisherList} T.\ Fisher,
{\em A table of $11$-congruent elliptic curves over the rationals}, \\
\url{https://www.dpmms.cam.ac.uk/~taf1000/papers/congr-11}

\bibitem{Halberstadt-Kraus-YE7}
Emmanuel Halberstadt and Alain Kraus, \emph{On the modular curves {$Y_E(7)$}},
  Math. Comp. \textbf{69} (2000), no.~231, 1193--1206. \MR{1651758}

\bibitem{Halberstadt-Kraus-XE7}
\bysame, \emph{Sur la courbe modulaire {$X_E(7)$}}, Experiment. Math.
  \textbf{12} (2003), no.~1, 27--40. \MR{2002672}


\begin{comment}
 
\bibitem{AnniSiksek} S.\ Anni and S.\ Siksek,
{\em Modular elliptic curves over real abelian fields and the generalized {F}ermat equation $x^{2\ell} + y^{2m}=z^p$}, Algebra \& Number Theory {\bf 10} (2016), no.6, 1147--1172

%\bibitem{bggt14}
%T. Barnet-Lamb, T. Gee, D. Geraghty, and R. Taylor,
%\emph{Potential automorphy and change of weight}, Ann. of Math. (2)
 % \textbf{179} (2014), no.~2, 501--609. \MR{3152941}

\bibitem{BennetSkinner} M.\ A.\ Bennett and C.\ M.\ Skinner,
{\em Ternary Diophantine equations via Galois representations and modular forms}, Canad.\ J.\ Math.\ {\bf 56} (2004), no. 1, 23--54.
 
%\bibitem{Bill} N. Billerey,
%{\em {\'E}quations de Fermat de type $(5,5,p)$},
%Bull.\ Austral.\ Math.\ Soc. {\bf 76} (2007), no. 2, 161--194.

%\bibitem{BD} N. Billerey and L.\ Dieulefait,
%{\em Solving Fermat-type equations $x^5 + y^5=d z^p$},
%Mathematics of Computation {\bf 79} (2010), no. 286, 535--544.

\bibitem{programs} N. Billerey, I. Chen, L. Demb\'el\'e, L. Dieulefait, and N. Freitas, 
{\em Supporting {{\tt Magma}} program files for this paper},
\url{http://math.univ-bpclermont.fr/~billerey/Research/BCDDF/}

\bibitem{BCDF} N. Billerey, I. Chen. L. Dieulefait, and N. Freitas, 
{\em A multi-Frey approach to Fermat equations of signature $(r,r,p)$},
Transactions of AMS (to appear).

\bibitem{BD14} C.~Breuil, and F.~Diamond,
{\em Formes modulaires de Hilbert modulo $p$ et valeurs d'extensions entre caract\`eres galoisiens.}
Ann. Sci. \'Ec. Norm. Sup\'er. (4) {\bf 47} (2014), no. 5, 905--974.

\bibitem{BMSI} Y.\ Bugeaud, M.\ Mignotte and S.\ Siksek
{\em A multi-Frey approach to some multi-parameter families of Diophantine equations},
Canadian Journal of Mathematics {\bf 60} (2008), 491-519.


\bibitem{magma}
W. Bosma, J. Cannon, and C. Playoust.
\newblock The {M}agma algebra system. {I}. {T}he user language.
\newblock {\em J. Symbolic Comput.}, 24(3-4):235--265, 1997.
\newblock Computational algebra and number theory (London, 1993).


%\bibitem{BreuilDiamond} C.\ Breuil and F.\ Diamond
%{\em Formes modulaires de Hilbert modulo $p$ et valeurs d'extensions galoisiennes},
%Annales Scientifiques de l'\'{E}cole Normale Sup\'{e}rieure, to appear.


%\bibitem{bdj10} K. Buzzard, F. Diamond, and F. Jarvis,
%{\em On Serre's conjecture for mod $\ell$ Galois representations over totally real fields.} 
%Duke Math. J. {\bf 155} (2010), no. 1, 105--161.

\bibitem{BH06} C.\ J.\ Bushnell, G.\ Henniart, 
{\em The local Langlands conjecture for $\GL(2)$.} 
{\it Grundlehren der Mathematischen Wissenschaften} {\bf 335},
Springer-Verlag, Berlin, 2006. xii+347 pp.


\bibitem{Cali} \'E.\ Cali, 
{\em D{\'e}faut de semi-stabilit{\'e} des courbes elliptiques dans le cas non ramifi{\'e}}, 
Canad.\ J.\ Math.\ {\bf 56} (2004), no 4, 673--698.

\bibitem{car86}  H. Carayol, 
{\em Sur les repr\'esentations $l$-adiques associ\'ees aux formes modulaires de Hilbert}. 
Ann. Sci. \'Ecole Norm. Sup. (4) {\bf 19} (1986), no. 3, 409--468.

%\bibitem{cli37}
%A. H. Clifford, {\em Representations induced in an invariant subgroup}, Ann.
%of Math. {\bf 38} (1937), 533--550.

\bibitem{cmsv} E. Costa, N. Mascot, J. Sijsling, J. Voight,
{\em Rigorous computation of the endomorphism ring of a Jacobian}, preprint.
Available at \url{https://arxiv.org/pdf/1705.09248.pdf}. 

\bibitem{DahmenSiksek} S. R. Dahmen, and S. Siksek,
{\em Perfect powers expressible as sums of two fifth or seventh powers.} 
Acta Arith. {\bf 164} (2014), no. 1, 65--100. 

\bibitem{DarmonDuke} H.\ Darmon,
{\em Rigid local systems, {H}ilbert modular forms, and {F}ermat's last theorem}, 
Duke Math.\ J.\ {\bf 102} (2000), no 3, 413--449.

\bibitem{DV13} L.~Demb\'el\'e, Lassina, and J.~Voight, 
{\em Explicit methods for Hilbert modular forms.} Elliptic curves, Hilbert modular forms and Galois deformations, 
135--198, Adv. Courses Math. CRM Barcelona, Birkh\"auser/Springer, Basel, 2013.

%\bibitem{DDT}
%H. Darmon, F. Diamond, and R. Taylor, 
%{\em Fermat's last theorem}. Elliptic curves, modular forms and Fermat's last theorem (Hong Kong, %1993), 2--140, 
%Int. Press, Cambridge, MA, 1997.

\bibitem{dk16}
L. Demb\'el\'e, and A. Kumar, 
{\em Examples of abelian surfaces with everywhere good reduction.} Math. Ann. {\bf 364} (2016), no. 3-4, 1365--1392.

%\bibitem{dk17} 
%L. Demb\'el\'e, and A. Kumar, 
%{\em On the existence of abelian surfaces with everywhere good reduction}, in preparation.

 
\bibitem{dia95} F. Diamond, 
{\em An extension of Wiles' results.} 
Modular forms and Fermat's last theorem (Boston, MA, 1995), 475--489, Springer, New York, 1997. 
 
%\bibitem{DF1} L.\ Dieulefait and N. Freitas,
%{\em The Fermat-type equations $x^5 + y^5 = 2z^p$ or $3z^p$ solved through $\Q$-curves},
%Mathematics of Computation {\bf 83} (2014), no. 286, 917--933.

%\bibitem{DFV} L.\ Demb\'el\'e, N.\ Freitas, and J.\ Voight,
%{\em On Galois inertial types of elliptic curves over $\Q_\ell$}, preprint.

\bibitem{BP} J.\  Burgos Gil and A.\ Pacetti, 
{\em Hecke and Sturm bounds for Hilbert modular forms over real quadratic fields.}
Math. Comp. {\bf 86} (2017), no. 306, 1949--1978. 

\bibitem{DD17} T. Dokchitser, C. Doris
{\em $3$-torsion and conductor of genus 2 curves}, preprint.
Available \url{https://arxiv.org/pdf/1706.06162.pdf}. 

\bibitem{Dor17} C. Doris, Package for computing the conductor or genus $2$ curves.
Available at \url{https://cjdoris.github.io/Genus2Conductor/\#installation}

\bibitem{ek14}
N. Elkies, and A. Kumar, 
{\em $K3$ surfaces and equations for Hilbert modular surfaces.}
Algebra Number Theory {\bf 8} (2014), no. 10, 2297--2411.
 
%\bibitem{Ell} J.\ Ellenberg,
%{\em Galois representations attached to $\Q$-curves and the Generalized Fermat equation $A^4 + B^2 = %C^p$}, Amer.\ J.\ Math.\ {\bf 126} (2016), no. 4, 763--787.

\bibitem{ell05} J. Ellenberg, {\em Serre's conjecture over $\F_9$},
Ann. of Math. (2) {\bf 161} (2005), no. 3, 1111--1142.


\bibitem{feit} W.\ Feit, 
{\em The Representation Theory of Finite Groups},
North-Holland, Amsterdam-New York-Oxford, 1982.

%\bibitem{F} N. Freitas,
%{\em Recipes for Fermat-type equations of the form $x^r + y^r = Cz^p$},
%Math.\ Z.\ {\bf 279} (2015), no. 3-4, 605--639.

\bibitem{F33p} N. Freitas,
{\em On the Fermat-type equation $x^3 + y^3 = z^p$},
Commentarii Mathematici Helvetici {\bf 91} (2016), 295--304.


%\bibitem{FS} Freitas, Nuno and Siksek, Samir,
%{\em Criteria for irreducibility of {${\rm mod}\, p$} representations of {F}rey curves}, J. Th\'eor. Nombres Bordeaux, 27, (2015), no. 1, 67--76.

\bibitem{FLHS} N. Freitas, B. Le Hung, S. Siksek,
{\em Elliptic Curves over Real Quadratic Fields are Modular},
Inventiones Mathematicae {\bf 201} (2015), no. 1, 159--206.


\bibitem{GV11}
M.~Greenberg, and J.~Voight, 
{\em Computing systems of Hecke eigenvalues associated to Hilbert modular forms.}
Math. Comp. {\bf 80} (2011), no. 274, 1071--1092.

%\bibitem{FNS23n} N.\ Freitas, B.\ Naskr{\k e}cki and M.\ Stoll,
%{\em The generalized Fermat equation with exponents $2,3,n$.} (preprint)
%\url{http://www.math.ubc.ca/~nuno/preprint3.pdf}

%\bibitem{Fuj} K.\ Fujiwara,
%{\em Level optimisation in the totally real case},
%{\tt arXiv:0602586v1}, 27 February 2006.

%\bibitem{Jarv} F.\ Jarvis,
%{\em Correspondences on Shimura curves and Mazur's principle at $p$},
%Pacific J. Math., {\bf 213} (2), 2004, 267--280.

\bibitem{kw09} C.~Khare, and J.-P. Wintenberger, 
{\em On Serre's conjecture for $2$-dimensional mod p representations of ${\rm Gal}(\overline{\Q}/\Q)$.} 
Ann. of Math. (2) {\bf 169} (2009), no. 1, 229--253.

\bibitem{kis09} M. Kisin, {\em Moduli of finite flat group schemes, and modularity}. 
Ann. of Math. (2) {\bf 170} (2009), no. 3, 1085--1180.

\bibitem{Kraus1990} A.\ Kraus,
{\em Sur le d\'efaut de semi-stabilit\'e des courbes elliptiques \`a r\'eduction additive},
Manuscripta Math.\ {\bf 69} (1990), no. 4, 353--385.

\bibitem{kut80} P. Kutzko, 
{\em The Langlands conjecture for $\GL_2$ of a local field.} 
Ann. of Math. (2) {\bf 112} (1980), no. 2, 381--412.

\bibitem{liu93} Q. Liu, 
{\em Courbes stables de genre 2 et leur sch\'ema de modules.}
Math. Ann. {\bf 295} (1993), no. 2, 201--222. 

\bibitem{martin} K.~Martin, 
{\em The Jacquet-Langlands correspondence, Eisenstein congruences, and integral $L$-values in weight $2$.} 
Math. Res. Lett. {\bf 24} (2017), no. 6, 1775--1795.

\bibitem{nek12} J.~Nekovar, 
\emph{{L}evel {R}aising and {A}nticyclotomic {S}elmer {G}roups for {H}ilbert {M}odular {F}orms of
{W}eight {T}wo}, Canad. J. Math. Vol. {\bf 64} (3), 2012 pp. 588--668.

%\bibitem{Raj} A.\ Rajaei,
%{\em On the levels of mod {$\ell$} Hilbert modular forms}, 
%J.\ reine angew.\ Math.\ 
%{\bf 537} (2001), 33--65.

\bibitem{ribet10}
K. Ribet, {\em Non-optimal levels of mod $\ell$ reducible Galois representations}, 
CRM Lecture notes, 2010. Available at \url{http://math.berkeley.edu/~ribet/crm.pdf}.

\bibitem{ribet} K. Ribet, {\em Abelian varieties over $\Q$ and modular forms}. 
Modular curves and abelian varieties, 241--261, Progr. Math., 224, Birkh\"auser, Basel, 2004.

\bibitem{SerreReps} J.-P.\ Serre, 
{\em Linear representations of finite groups},
Springer-Verlag, New York-Heidelberg, 1977.
Translated from the second French edition by Leonard L. Scott,
Graduate Texts in Mathematics, Vol. 42. 
 
\bibitem{ST1968} J.-P.\ Serre and J.\ Tate,
{\em Good reduction of abelian varieties},
Annals of Math.\ {\bf 88} (1968), no. 2, 492--517.

\bibitem{shi78} Goro Shimura, 
\emph{The special values of the zeta functions associated with 
{H}ilbert modular forms}, Duke Math. J. \textbf{45} (1978), no.~3, 637--679.


%\bibitem{stein} W.~Stein, {\em Modular forms, a computational approach}. 
%With an appendix by Paul E. Gunnells. Graduate Studies in Mathematics, {\bf 79}. 
%American Mathematical Society, Providence, RI, 2007. xvi+268 pp.


\bibitem{wilson98} J.\ Wilson,
{\em Curves of genus 2 with real multiplication by a square root of 5}, PhD thesis, University of Oxford, 1998.

\bibitem{yoo}H.~Yoo, {\em Non-optimal levels of a reducible mod $\ell$ modular representation}, preprint.
Available at \url{https://arxiv.org/pdf/1409.8342.pdf}.

\bibitem{tay89}
R. Taylor, 
\emph{On {G}alois representations associated to {H}ilbert modular forms}, 
Invent.\ Math.\ \textbf{98} (1989), no.~2, 265--280.
  
 \bibitem{zha01}S.~Zhang, 
 \emph{ {H}eights of {H}eegner {P}oints on {S}himura {C}urves},
Annals of Math., Second Series, Vol. {\bf 153}, No. 1 (2001), pp. 27--147.
\end{comment}
\end{thebibliography}



\end{document}
