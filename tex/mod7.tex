\documentclass[12pt]{amsart}
\usepackage{fullpage,url,amssymb,enumerate,colonequals, numprint}

% \usepackage{amscd}   % for commutative diagrams
%\usepackage[all]{xy} % for complicated commutative diagrams, use pdf driver
\usepackage{mathrsfs} % for \mathscr (script letters)
% \usepackage{MnSymbol} % for dashed arrow

%\usepackage{mathabx}
%\usepackage{MnSymbol}
%\usepackage{extarrows}
%\usepackage{rotating}
%\usepackage{mathrsfs}
\usepackage{lscape}
\usepackage[all,cmtip]{xy}

% This is for resizeable \Sha
%\usepackage{natbib}
%\usepackage[OT2,T1]{fontenc}
%\DeclareSymbolFont{cyrletters}{OT2}{wncyr}{m}{n}
%\DeclareMathSymbol{\Sha}{\mathalpha}{cyrletters}{"58}


\usepackage{color}

\usepackage[
%       draft,
        colorlinks, citecolor=darkgreen,
        backref,
        pdfauthor={Nuno Freitas}, % add other authors
]{hyperref}
%\usepackage[alphabetic,backrefs,lite]{amsrefs} % for bibliography

\usepackage{array, booktabs, comment, multirow, todonotes}

% label and link to an elliptic curve /Q:
% version using Cremona labels:
\newcommand{\lmfdbec}[3]{\href{http://www.lmfdb.org/EllipticCurve/Q/#1#2#3}{{\text{\rm#1#2#3}}}}
% version using LMFDB labels:
%\newcommand{\lmfdbec}[3]{\href{http://www.lmfdb.org/EllipticCurve/Q/#1/#2/#3}{{\text{\rm#1.#2#3}}}}
% label and link to an elliptic curve isogeny class /Q:
\newcommand{\lmfdbeciso}[2]{\href{http://www.lmfdb.org/EllipticCurve/Q/#1/#2}{\text{\rm#1.#2}}}


\newcommand{\defi}[1]{\textsf{#1}} % for defined terms

\newcommand{\dashedarrow}{\dashrightarrow}

% Characters
\newcommand{\Aff}{\mathbb{A}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\Fbar}{{\overline{\F}}}
\newcommand{\G}{\mathbb{G}}
\newcommand{\Gm}{\mathbb{G}_{\mathrm{m}}}
\newcommand{\bbH}{\mathbb{H}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Qbar}{{\overline{\Q}}}
\newcommand{\Zhat}{{\hat{\Z}}}
\newcommand{\Ebar}{{\overline{E}}}
\newcommand{\Zbar}{{\overline{\Z}}}
\newcommand{\kbar}{{\overline{k}}}
\newcommand{\Kbar}{{\overline{K}}}
\newcommand{\rhobar}{{\overline{\rho}}}
\newcommand{\ksep}{{k^{\operatorname{sep}}}}

\newcommand{\frp}{{\mathfrak p}}

\newcommand{\Adeles}{\mathbf{A}}
\newcommand{\kk}{\mathbf{k}}

\newcommand{\mm}{\mathfrak{m}}

\newcommand{\eps}{\varepsilon}

\newcommand{\uom}{\underline{\omega}}

% bold characters
\newcommand{\boldf}{\mathbf{f}}
\newcommand{\boldl}{\ensuremath{\boldsymbol\ell}}
\newcommand{\boldL}{\mathbf{L}}
\newcommand{\boldr}{\mathbf{r}}
\newcommand{\boldw}{\mathbf{w}}
\newcommand{\boldzero}{\mathbf{0}}
\newcommand{\boldomega}{\ensuremath{\boldsymbol\omega}}


% mathcal characters
\newcommand{\calA}{\mathcal{A}}
\newcommand{\calB}{\mathcal{B}}
\newcommand{\calC}{\mathcal{C}}
\newcommand{\calD}{\mathcal{D}}
\newcommand{\calE}{\mathcal{E}}
\newcommand{\calF}{\mathcal{F}}
\newcommand{\calG}{\mathcal{G}}
\newcommand{\calH}{\mathcal{H}}
\newcommand{\calI}{\mathcal{I}}
\newcommand{\calJ}{\mathcal{J}}
\newcommand{\calK}{\mathcal{K}}
\newcommand{\calL}{\mathcal{L}}
\newcommand{\calM}{\mathcal{M}}
\newcommand{\calN}{\mathcal{N}}
\newcommand{\calO}{\mathcal{O}}
\newcommand{\calP}{\mathcal{P}}
\newcommand{\calQ}{\mathcal{Q}}
\newcommand{\calR}{\mathcal{R}}
\newcommand{\calS}{\mathcal{S}}
\newcommand{\calT}{\mathcal{T}}
\newcommand{\calU}{\mathcal{U}}
\newcommand{\calV}{\mathcal{V}}
\newcommand{\calW}{\mathcal{W}}
\newcommand{\calX}{\mathcal{X}}
\newcommand{\calY}{\mathcal{Y}}
\newcommand{\calZ}{\mathcal{Z}}

%mathfrak characters

\newcommand{\ff}{\mathfrak{f}}
\newcommand{\fm}{\mathfrak{m}}
\newcommand{\fM}{\mathfrak{M}}
\newcommand{\fp}{\mathfrak{p}}
\newcommand{\fP}{\mathfrak{P}}
\newcommand{\fq}{\mathfrak{q}}
\newcommand{\fN}{\mathfrak{N}}

\newcommand{\CC}{\mathscr{C}}
\newcommand{\FF}{\mathscr{F}}
\newcommand{\GG}{\mathscr{G}}
\newcommand{\II}{\mathscr{I}}
\newcommand{\JJ}{\mathscr{J}}
\newcommand{\LL}{\mathscr{L}}
\newcommand{\NN}{\mathscr{N}}
\newcommand{\OO}{\mathscr{O}}
\newcommand{\WW}{\mathscr{W}}
\newcommand{\XX}{\mathscr{X}}
\newcommand{\ZZ}{\mathscr{Z}}

% Math operators
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Br}{Br}
\DeclareMathOperator{\cd}{cd}
\DeclareMathOperator{\Card}{Card}
\DeclareMathOperator{\Char}{char}
\DeclareMathOperator{\Cl}{Cl}
\DeclareMathOperator{\codim}{codim}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Cor}{Cor}
\DeclareMathOperator{\divv}{div}
\DeclareMathOperator{\Div}{Div}
\DeclareMathOperator{\Det}{Det}
\DeclareMathOperator{\Dic}{Dic}

\DeclareMathOperator{\End}{End}
\newcommand{\END}{{\EE}\!nd}
\DeclareMathOperator{\Eq}{Eq}
\DeclareMathOperator{\Ext}{Ext}
\newcommand{\EXT}{{\E}\!xt}
\DeclareMathOperator{\Fix}{\tt Fix}
\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Frob}{Frob}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Gr}{Gr}
\DeclareMathOperator{\Hom}{Hom}
\newcommand{\HOM}{{\HH}\!om}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Ind}{Ind}
\DeclareMathOperator{\inv}{inv}
\DeclareMathOperator{\Jac}{Jac}
\DeclareMathOperator{\JL}{JL}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Lie}{Lie}
\DeclareMathOperator{\Log}{Log}
\DeclareMathOperator{\MakeDecentModel}{\tt MakeDecentModel}
\DeclareMathOperator{\nil}{nil}
\DeclareMathOperator{\Norm}{Norm}
\DeclareMathOperator{\NP}{NP}
\DeclareMathOperator{\Num}{Num}
\DeclareMathOperator{\odd}{odd}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\Pic}{Pic}
\DeclareMathOperator{\PIC}{\bf Pic}
\DeclareMathOperator{\Prob}{\bf P}
\DeclareMathOperator{\Proj}{Proj}
\DeclareMathOperator{\PROJ}{\bf Proj}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\rec}{rec}
\DeclareMathOperator{\re}{Re}
\DeclareMathOperator{\reg}{reg}
\DeclareMathOperator{\res}{res}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\rk}{rk}
\DeclareMathOperator{\scd}{scd}
\DeclareMathOperator{\Sel}{Sel}
\DeclareMathOperator{\Sp}{Sp}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\SPEC}{\bf Spec}
\DeclareMathOperator{\Spf}{Spf}
\DeclareMathOperator{\sss}{ss}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Sym}{Sym}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\T}{\mathbb{T}}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\tw}{tw}
\DeclareMathOperator{\trdeg}{tr deg}
\DeclareMathOperator{\WD}{WD}

% Categories
\newcommand{\Ab}{\operatorname{\bf Ab}}
\newcommand{\Groups}{\operatorname{\bf Groups}}
\newcommand{\Schemes}{\operatorname{\bf Schemes}}
\newcommand{\Sets}{\operatorname{\bf Sets}}

% Text subscripts, superscripts
\newcommand{\ab}{{\operatorname{ab}}}
\newcommand{\an}{{\operatorname{an}}}
\newcommand{\Az}{{\operatorname{Az}}}
\newcommand{\CS}{\operatorname{\bf CS}}
\newcommand{\et}{{\operatorname{et}}}
\newcommand{\ET}{{\operatorname{\bf \acute{E}t}}}
\newcommand{\fl}{{\operatorname{f\textcompwordmark l}}}
\newcommand{\good}{{\operatorname{good}}}
\newcommand{\op}{{\operatorname{op}}}
\newcommand{\perf}{{\operatorname{perf}}}
\newcommand{\red}{{\operatorname{red}}}
\newcommand{\regular}{{\operatorname{regular}}}
\newcommand{\sing}{{\operatorname{sing}}}
\newcommand{\smooth}{{\operatorname{smooth}}}
\newcommand{\tH}{{\operatorname{th}}}
\newcommand{\tors}{{\operatorname{tors}}}
\newcommand{\nontors}{{\operatorname{non-tors}}}
\newcommand{\unr}{{\operatorname{unr}}}
\newcommand{\Zar}{{\operatorname{Zar}}}
\newcommand{\ns}{{\operatorname{ns}}}
\renewcommand{\sp}{{\operatorname{sp}}}
\newcommand{\vv}{\upsilon}
\newcommand{\Cech}{\v{C}ech}
\newcommand{\E}{{\operatorname{\bf E}}}
\newcommand{\GalQ}{{\Gal}(\Qbar/\Q)}
\newcommand{\GL}{\operatorname{GL}}
\newcommand{\HH}{{\operatorname{H}}}
\newcommand{\HHcech}{{\check{\HH}}}
\newcommand{\HHat}{{\hat{\HH}}}
\newcommand{\M}{\operatorname{M}}
\newcommand{\PGL}{\operatorname{PGL}}
\newcommand{\PSL}{\operatorname{PSL}}
\newcommand{\SL}{\operatorname{SL}}

\newcommand{\del}{\partial}
\newcommand{\directsum}{\oplus} % binary direct sum
\newcommand{\Directsum}{\bigoplus} % direct sum of a collection
\newcommand{\injects}{\hookrightarrow}
\newcommand{\intersect}{\cap} % binary intersection
\newcommand{\Intersection}{\bigcap} % intersection of a collection
\newcommand{\isom}{\simeq}
\newcommand{\notdiv}{\nmid}
\newcommand{\surjects}{\twoheadrightarrow}
\newcommand{\tensor}{\otimes} % binary tensor product
\newcommand{\Tensor}{\bigotimes} % tensor product of a collection
\newcommand{\union}{\cup} % binary union
\newcommand{\Union}{\bigcup} % union of a collection

\newcommand{\Algorithm}{\textbf{Algorithm}\ }
\newcommand{\Subroutine}{\textbf{Subroutine}\ }

\newcommand{\isomto}{\overset{\sim}{\rightarrow}}
\newcommand{\isomfrom}{\overset{\sim}{\leftarrow}}
\newcommand{\leftexp}[2]{{\vphantom{#2}}^{#1}{#2}}
\newcommand{\rholog}{\rho \log}
\newcommand{\sigmaiota}{{\leftexp{\sigma}{\iota}}}
\newcommand{\sigmaphi}{{\leftexp{\sigma}{\phi}}}
\newcommand{\sigmatauphi}{{\leftexp{\sigma\tau}{\phi}}}
\newcommand{\tauphi}{{\leftexp{\tau}{\phi}}}
\newcommand{\To}{\longrightarrow}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}

% imported from JC's file
\DeclareMathOperator{\id}{id}
\def\w{\omega}
\def\r3{\sqrt{-3}}
\def\pibar{\overline{\pi}}
%\def\legover{\overwithdelims()}
\def\legendre#1#2{\displaystyle{\frac{#1}{#2}}}


\numberwithin{equation}{section}

%\newtheorem{theorem}{Theorem}
%\newtheorem{lemma}{Lemma}
%\newtheorem{corollary}{Corollary}
%\newtheorem{proposition}{Proposition}

%\theoremstyle{definition}
%\newtheorem{definition}[equation]{Definition}
%\newtheorem{question}[equation]{Question}
%\newtheorem{conjecture}[equation]{Conjecture}
%\newtheorem{example}[equation]{Example}
%\newtheorem{examples}[equation]{Examples}

%\theoremstyle{remark}
%\newtheorem{remark}[equation]{Remark}
%\newtheorem{remarks}[equation]{Remarks}


\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{question}[theorem]{Question}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{remarks}[theorem]{Remarks}

\newcommand{\Sage}{{\sc SageMath}}
\newcommand{\Magma}{{\sc Magma}}

\definecolor{darkgreen}{rgb}{0,0.5,0}

\setlength{\parindent}{0mm}
\setlength{\parskip}{1ex plus 0.5ex}

\begin{document}

\title{On the symplectic type of congruences between elliptic curves modulo small primes}

\author{John Cremona}
\address{Mathematics Institute,
         University of Warwick,
         Coventry CV4 7AL,
         United Kingdom}
\email{j.e.cremona@warwick.ac.uk}


\author{Nuno Freitas}
\address{Mathematics Institute,
         University of Warwick,
         Coventry CV4 7AL,
         United Kingdom}
\email{nunobfreitas@gmail.com}


\date{\today}

\keywords{Elliptic curves, Weil pairing, Galois representations, symplectic isomorphisms}
%\subjclass[2010]{Primary 11D41; Secondary 11G10, 11F80.}

\thanks{JEC is supported by EPSRC Programme Grant EP/K034383/1
  \textit{LMF: L-Functions and Modular Forms}, and the Horizon 2020
  European Research Infrastructures project \textit{OpenDreamKit}
  (\#676541)}
\thanks{NF is supported by the European Union's
  Horizon 2020 research and innovation programme under the Marie
  Sk\l{l}odowska-Curie grant agreement No.\ 747808}


\begin{abstract} {\bf Needs improvement.}
We describe a procedure to determine the symplectic type of
isomorphisms between the $7$- or $11$-torsion modules of elliptic curves over~$\Q$.  We
apply it to classify all the congruences in LMFDB.
\end{abstract}

\maketitle


\section{Introduction}

Let $p \geq 3$ be a prime. Write $G_\Q = \Gal(\Qbar/\Q)$ for the
absolute Galois group of $\Q$.  Let $E$ and $E'$ be elliptic curves defined over $\Q$, and write $E[p]$ and $E'[p]$ for their $p$-torsion $G_\Q$-modules.

Let $\phi : E[p] \to E'[p]$ be an isomorphism of $G_\Q$-modules.
There is an element $d(\phi) \in \F_p^\times$ such that the Weil 
pairings~$e_{E,p}$ and~$e_{E',p}$ satisfy
\[
e_{E',p}(\phi(P), \phi(Q)) = e_{E,p}(P, Q)^{d(\phi)}
\]
for all $P, Q \in E[p]$.  We say that $\phi$ is a {\it symplectic
  isomorphism} or an {\it anti-symplectic isomorphism} if $d(\phi)$ is
a square or a non-square modulo~$p$, respectively.

For example, suppose that~$\phi$ is induced by an isogeny (also
denoted~$\phi$) from $E$ to $E'$, of degree $\deg(\phi)$ coprime
to~$p$. Then, using Weil reciprocity, 
we have 
\[
  e_{E',p}(\phi(P), \phi(Q)) = e_{E,p}(P, \hat\phi\phi(Q)) =
  e_{E,p}(P, \deg(\phi)(Q)) = e_{E,p}(P, Q)^{\deg(\phi)},
  \]
  where $\hat{\phi}$ denotes the dual isogeny; 
  thus $d(\phi)=\deg\phi\pmod{p}$.
  Hence $\phi$ is symplectic or antisymplectic according as $\deg\phi$
is a quadratic residue or nonresidue mod~$p$, respectively.  We will refer to
this condition as the \emph{isogeny criterion}.

Given $G_\Q$-isomorphic modules $E[p]$ and~$E'[p]$, it is possible
that isomorphisms with both symplectic types exist; this occurs if and
only if $E[p]$ admits an anti-symplectic automorphism.  Let the
mod~$p$ representation attached to~$E/\Q$ be $\rhobar_{E,p} : G_\Q \to
\GL_2(\F_p)$.
\begin{proposition}\label{P:auto}
  Let $E$ and~$E'$ be elliptic curves defined over~$\Q$ such that
  $E[p]\cong E'[p]$ as $G_\Q$-modules.
  \begin{enumerate}
    \item If $E[p]$ is irreducible, then the isomorphism $E[p]\cong
      E'[p]$ is unique up to scaling; hence its symplectic type is
      well-defined.
      \item If $p\ge7$ then the same conclusion also holds when
        $E[p]$ is reducible.
  \end{enumerate}
\end{proposition}
\begin{proof}
In the first case, the result follows from Schur's Lemma and the
trivial observation that scalar matrices have square determinant.

In the second case, from the classification of the possible images of
$\rhobar_{E,p}$ (as in \cite{Sutherland}, for example) we see that the
image is nonabelian, so again the only automorphisms are given by
scalar matrices.

``This follows from Corollary~3 and Proposition~2 in~\cite{FKSym}.'' ? 
\end{proof}

For an example where both types of isomorphism exist, take $p=5$ and
$E$, $E'$ to be the curves\footnote{Throughout the paper we use
  Cremona labels for elliptic curves over~$\Q$; these curves may be
  found in the LMFDB (see \cite{lmfdb}).} $\lmfdbec{11}{a}{1}$ and
$\lmfdbec{1342}{c}{2}$, respectively (see~\cite[Example~5.2]{FKSym}
for more details).

\begin{comment}
both have $5$-torsion Galois module isomorphic to $\mu_5
\times \Z/5\Z$.  Now let $P,Q \in E[5]$ and $P',Q' \in E'[5]$ be bases
such that $P$, $P'$ are defined over~$\Q$.  The map defined by $P
\mapsto P'$ and $Q \mapsto n\cdot Q'$ (with $5 \nmid n$) is a
$G_\Q$-isomorphism which is symplectic if and only if $n$ is a square
mod~$5$.  Moreover, the automorphism $\alpha$ of $E[5]$ given by
$\alpha(P) = P$ and $\alpha(Q) = 2Q$ is anti-symplectic because $2$ is
not a square modulo~$5$.
\end{comment}

Despite the existence of examples such as this, normally when a
$G_\Q$-isomorphism $\phi : E[p] \simeq E'[p]$ exists, there is only
one possible symplectic type for any such~$\phi$.  It is then natural
to consider triples $(E,E',p)$ where $E/\Q$ and $E'/\Q$ are elliptic
curves with isomorphic $p$-torsion such that the $G_\Q$-modules
isomorphisms $\phi : E[p] \rightarrow E'[p]$ are either all symplectic
or all anti-symplectic.  In this case, we will say that the {\it
  symplectic type} of $(E,E',p)$ is respectively symplectic or
anti-symplectic.  The problem of determining the symplectic of
$(E,E',p)$ was extensively studied by the second author and Alain
Kraus in~\cite{FKSym}.

The isogeny criterion gives an easy solution when $(E,E',p)$
arises from an isogeny $h \colon E \to E'$ of degree~$n$ coprime
to~$p$, since in such cases $d(h|_{E[p]}) = n$ and the symplectic type
of $(E,E',p)$ is symplectic if $n$ is a square mod~$p$ and
anti-symplectic otherwise.

Given a generic triple $(E, E', p)$, in principle, one
could compute the $p$-torsion fields of $E$ and $E'$,
write down the Galois action on $E[p]$ and $E'[p]$ and check if they
are symplectically or anti-symplectically isomorphic. However, the
degree of the $p$-torsion fields grows very fast with~$p$ making this
method not practical already for $p = 5$.

One way to circumvent this computational problem is to use the methods
presented in~\cite{FKSym}. Indeed, the main objective of {\it
  loc. cit.} was to establish several {\it local symplectic criteria},
allowing one to determine the symplectic type of $(E,E',p)$ using only
standard information about the local curves $E/\Q_\ell$ and
$E'/\Q_\ell$ at a single prime $\ell \neq p$ and congruence conditions
on~$p$. Furthermore, in~\cite{FKSym} it is also proved that if the
symplectic type of~$(E,E',p)$ is encoded in local information at a
single prime $\ell \neq p$, then one of the local criteria will
successfully determine it.  There are cases where the local methods
are insufficient: however, this can occur only when the image
of~$\rhobar_{E,p}$ contains no elements of order~$p$; see
\cite[Proposition~16]{FKSym} for such an example.

The main objective of this paper is to give a uniform procedure to
determine, for a few small~$p$, the symplectic type of
triples~$(E,E',p)$ independently of the image of~$\rhobar_{E,p}$.

We have implemented in {\Magma} \cite{magma} and {\Sage} \cite{sage}
the methods from this paper together with those from~\cite{FKSym}. We
have used our code to classify the symplectic types of congruences
between curves in the LMFDB (see \cite{lmfdb}), namely all elliptic
curves defined over~$\Q$ of conductor less than~$\numprint{400000}$.
We found, for $p$ in the range $7 \leq p \leq 17$, all the congruences
in the database up to twist; we report on the results obtained in
Sections~\ref{S:statistics}~and~\ref{S:summary}.

The description of our method also includes a discussion on how to
determine whether $E[p]$ and~$E'[p]$ are isomorphic (ignoring the
symplectic structure) in both the irreducible and reducible
cases. Moreover, we give two global symplectic criteria for particular
types of congruences: Theorem~\ref{T:Cartan} covers congruences
between an elliptic curve~$E$ with mod~$p$ image in the normalizer of
a Cartan subgroup and a certain quadratic twist of~$E$ and
Theorem~\ref{T:j=0} covers a mod~$7$ congruence between elliptic
curves~$E$ with $j(E)=0$ and a sextic twist of~$E$.

Triples~$(E,E',p)$ such that $E'$ is a twist of~$E$ arise in a number
of contexts in our study.  The following result characterises this
situation.

\begin{proposition}\label{P:twist}
Let $E$ and~$E'$ be non-isomorphic elliptic curves over~$\Q$ with
$j(E)=j(E')$, such that $E[p]\cong E'[p]$ with $p\ge3$.
\begin{enumerate}
  \item If $E'=E^d$ is the quadratic twist of~$E$ by~$d\in\Q^*$ (which
    is always the case unless $j(E)\in\{0,1728\}$) then the image
    of~$\rhobar_{E,p}$ is contained in the normaliser of a split
    Cartan subgroup of $\GL_2(\F_p)$ but not in the subgroup itself.
    When $p\ge7$, the twist~$d$ is uniquely determined by~$E$ unless
    $j(E)=0$ in which case there are three such twists.
   \item If $j(E)=0$ and $E'$ is a sextic twist of~$E$ (but not a
     quadratic twist), then...
   \item If $j(E)=1728$ and $E'$ is a quartic twist of~$E$ (but not a
     quadratic twist), then...
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $\chi$ be the quadratic character associated to the
  extension $\Q(\sqrt{d})/\Q$.  For almost all primes~$\ell$ we have
  on the one hand, since $E'=E^d$,
  \[
  a_\ell(E') = \chi(\ell) a_\ell(E),
  \]
  (where $a_\ell(E)$ denotes the trace of Frobenius of $E\mod\ell$),
  and on the other hand, since $E'[p]\cong E[p]$,
  \[
  a_\ell(E') \equiv a_\ell(E) \mod{p}.
  \]
  Hence for all primes~$\ell$ which are inert in~$\Q(\sqrt{d})$ we have
  \[
  a_\ell(E') \equiv a_\ell(E) \equiv0 \mod{p}.
  \]
  So the image $H=\rhobar_{E,p}(G_\Q)$ has a subgroup~$H^+$ of
  index~$2$ such that all elements of~$H\setminus H^+$ have trace~$0$.
  Such elements have order~$2$ in $\PGL_2(\F_p)$.  From the
  classification of subgroups of $\PGL_2(\F_p)$ it follows that $H$ is
  contained in the normaliser of a Cartan subgroup~$C$ and $H^+=H\cap
  C$.

Consulting Table~3 of \cite{Sutherland} we find that conjecturally we
have $p\le11$.  For $p=7$ the only images are (in the notation of
\cite{Sutherland}) $7Ns$ (the full normaliser of a split Cartan),
$7Nn$ (the full normaliser of a nonsplit Cartan), and in addition
$7Ns.2.1$ and $7Ns.3.1$ which only occur for $j=2268945/128$ and
$7Ns.6.1.2$ which only occurs for $j=0$.  Each of these images
contains a unique subgroup of index~$2$, except the last.  In that
case (which occurs for example for the curve $\lmfdbec{441}{a}{1}$)
the twists by $-3$, $-7$ and~$21$ all have isomorphic $7$-torsion
modules.

For $p=11$, as well as images $11Nn$ and $11Ns$ we find $11Nn.1.4$
which only occurs for $j=0$; each of these has a unique index~$2$
subgroup.

  (2)

  (3)

\end{proof}

\subsection{Modular parametrizations}
The modular curve $X(p)$ parametrizes elliptic curves with full
level~$p$ structure.  It has genus~$0$ for $p=2,3,5$, genus~$3$ for
$p=7$ and genus ${}\ge26$ for $p\ge11$.  Fixing an elliptic
curve~$E/\Q$, the curve $X_E(p)$, which is a twist of~$X(p)$ (and
hence has the same genus) parametrizes pairs $(E',\phi)$ such that
$\phi$ is a symplectic isomorphism~$E[p]\cong E'[p]$; similarly
$X_E^-(p)$ parametrizes antisymplectic isomorphisms.  In the
symplectic case, $E$ itself (together with the identity map) gives a
base point on $X_E(p)$, while $X_E^-(p)$ may have no rational points.

It follows that congruences modulo~$p$ for $p\ge5$ are common.  There
are certainly many mod~$3$ and mod~$5$ congruences in the database,
but we have not searched for these systematically. Indeed, since
$X_E(3)$ and $X_E(5)$ have genus~0, for each fixed~$E$, there will
always be congruences that are not part of the database independently
of its range. In contrast, for primes~$p \geq 7$, the curve $X_E(p)$
has genus~$\geq 3$ and so for each~$E$ there are only finitely many
mod~$p$ congruences with~$E$, and moreover up to twist we expect only
finitely many congruence triples $(E,E',\phi)$.  Hence the database
might contain all such congruences; however proving this fact for a
fixed~$E$ is a hard problem.

Below we will study congruences modulo~$p$ systematically for $p\ge7$,
giving more detail for $p=7$.  The number of congruences in the
database for $p=11$, $p=13$, and $p=17$ is small; in the latter case,
there is only one such congruence (up to twist), as noted in
\cite{Billerey17}.  An explicit form of the Frey-Mazur conjecture (see
below) asserts that there should exist no congruences modulo~$p>17$
apart from those induced by isogenies.

For $p=7$, we make use of explicit equations for $X_E(7)$ and
$X_E^-(7)$.  By ``explicit equations'' for $X_E^{\pm}(p)$, we mean the
following.
\begin{itemize}
  \item An explicit model for a family of curves, with equations whose
    coefficients are polynomials in $\Q[a,b]$, such that specialising
    $a,b$ gives a model for $X_E^{\pm}(p)$ where $E$ is the elliptic
    curve with equation $Y^2=X^3=aX+b$; each rational point $P$ is
    either a cusp of the modular curve or encodes a pair $(E',\phi)$
    such that $(E,E',\phi)$ is a symplectic (respectively,
    antsymplectic) triple.
    \item A rational function with coefficients in $\Q(a,b)$ defining
      the map $j: X_E^{\pm}(p) \to \PP^1$, taking a point
      $P=(E',\phi)$ to $j(E')$.  The degree of this map is the
      index~$[\PSL_2(\Z):\Gamma(p) = |\PSL_2(\F_p)$: for example, when
        $p=7$ the degree is~$168$.
      \item Rational functions $c_4$ and $c_6$ such that for each
        non-cuspidal point~$P=(E',\phi)$, a model for $E'$ is
        $Y^2=X^3+a'X+b'$ where $(a',b')=(-27c_4(P),-54c_6(P))$.
\end{itemize}
Equations for $X_E(7)$, in this sense, were obtained by Kraus and
Halberstadt in~\cite{Halberstadt-Kraus-XE7}, though the functions
$c_4$ and $c_6$ in \cite{Halberstadt-Kraus-XE7} are only defined away
from $5$ points (which may or may not be rational); more complete
equations, together with $X_E^-(7)$ and $X_E^{\pm}(11)$ were found by
Fisher in~\cite{Fisher}.

\subsection{Further motivation} \label{S:motivation}
We finish this introduction with a discussion 
on how the methods of this paper complement the local methods in~\cite{FKSym}.

Recall that, loosely speaking, the modular curves $X_E(p)$ and
$X_E^-(p)$ parametrize, respectively, elliptic curves with
$p$-torsion modules symplectically and anti-symplectically isomorphic
to~$E[p]$; thus triples $(E,E',p)$ as above give rise to $\Q$-points
on at least one of these curves. 

The Frey-Mazur conjecture states there is a constant $C \geq 18$ such that, if $E/\Q$ and $E'/\Q$ satisfy $E[p] \simeq E'[p]$ as
$G_\Q$-modules for some prime $p > C$, then $E$ and $E'$ are
$\Q$-isogenous. In view of this conjecture, any~$(E,E',p)$ with $p > C$ arises from an isogeny, hence its symplectic type is easily determined by the isogeny criterion. Thus we are interested in primes $p \leq C$.

%% For $p=3,5$ the modular curves $X(p)$  have genus~0, equations for $X_E(p)$ and $X_E^-(p)$ are well known and we can obtain infinitely many triples $(E,E',p)$ with each symplectic type. 

As mentioned above, if no local
symplectic criterion from~\cite{FKSym} applies to~$(E,E',p)$ then the image of $\rhobar_{E,p}$ is irreducible and contains no element of order~multiple of~$p$. Furthermore, 
when $\rhobar_{E,p}$ is reducible the bounds
on a prime~$\ell$ for which a local criterion at~$\ell$ 
applies are not useful in practice.
From the strong form of Serre's uniformity conjecture, these `bad' cases for the local methods imply that either $E$ has CM 
or one of the following holds:
\begin{itemize}
 \item[(i)] $p=3,5,7$ and $\rhobar_{E,p}$ is reducible or has image the normalizer of a Cartan subgroup;
 \item[(ii)] $p=11$ and $\rhobar_{E,p}$ has image the normalizer of non-split Cartan subgroup;
 \item[(iii)] $p=13$ and $\rhobar_{E,p}$ is reducible; 
 \item[(iv)] $p=13$ and $\rhobar_{E,p}$ has exceptional image projectively isomorphic to $S_4$;
 \item[(v)] $p=11,17$ or $37$, and $j(E)$ is listed
 in \cite[Table~2.1]{DahmenPhD}; in particular, $\rhobar_{E,p}$ is reducible.
\end{itemize}
The method we describe in Section~\ref{S:statistics} for $p=7$ can be
adapted by replacing the modular curves~$X_E(7)$ by $X_E(p)$ when
explicit equations for the latter are known, which is the case for
$p=3,5$ and~$11$. This method works independently of the image
of~$\rhobar_{E,p}$, so covers cases (i) and (ii) above.

In \cite[Corollary~1.9]{BarinderCrem} is a list of~$3$ rational
$j$-invariants of elliptic curves over~$\Q$ satisfying (iv); it has
recently been shown (see~\cite{BDMTV-S4}) that the associated
genus~$3$ modular curve~$X_{S_4}(13)$ found explicitly
in~\cite{BarinderCrem} has no more rational points, and hence that
this list is complete. By Proposition~\ref{P:twist}, none of these
curves is mod~$13$ congruent to a quadratic twist of another of them
(including itself); the same is true for the curves and values of~$p$
in case (v).

The remaining case~(iii) includes the infinitely many curves with
$\rhobar_{E,13}$ reducible (recall that $X_0(13)$ has genus~0). In
spite of the lack of helpful bounds as mentioned above, a congruence
between such curves will often be addressed by local methods in
practice. Indeed, the bounds are very large as they depend on
Tchebotarev density theorem to predict a prime~$\ell$ of good
reduction for~$E$ where Frobenius has order multiple of~$p$; however,
in practice, it is usually easy to find such a prime~$\ell$ after
trying a few small primes.  There are no such mod~$13$ examples in the
LMFDB database, instead we refer to \cite[Example~31.2]{FKSym} for
such an example with $p=7$.

\section{Auxiliary results for the reducible case}

Some of the mod~$7$ congruences 
$E[7] \simeq E'[7]$ in the LMFDB database occur 
when these Galois modules are reducible. Compared to the irreducible case, establishing reducible congruences requires extra work because when working with the semisimplifications $E[7]^{ss}$ and $E'[7]^{ss}$ important information is lost.
The objective of this section is to establish Theorem~\ref{T:reducible} which will allow us to rigorously prove congruences in the reducible case.


Let $B \subset \GL_2(\F_p)$ be the Borel subgroup, i.e. the upper triangular matrices. Let $H \subset B$ be a subgroup of order divisible by~$p$. 
We can write~$H = D\cdot U$ where $D \subset B$ is a subgroup of diagonal matrices and 
$U$ is cyclic generated by $\left(\begin{smallmatrix}
                            1 & 1 \\
                            0 & 1
                            \end{smallmatrix} \right)$.   
Moreover, $U$ a normal subgroup of~$H$ 
and we write $\pi : H \to H/U \simeq D$ for the quotient map.

\begin{proposition} \label{P:inner}
Let $H = D \cdot U \subset B$ and $\pi$ be as above. 
Let $\phi$ be an automorphism of~$H$. Assume that  
$\pi(x) = \pi(\phi(x))$ for all $x \in H$. 

Then $\phi$ is given by conjugation in $B$, i.e. there is $A \in B$ such that $\phi(x) = AxA^{-1}$. 
\end{proposition}
\begin{proof}
Let $x \in H$ and write it as $x = du$ with $d \in D, u \in U$.
Note that $U$ is the unique normal subgroup with order~$p$, so 
$\phi(U) = U$ and $\phi(D)=D$ for all $\phi \in \Aut H$.
By hypothesis, we have 
\[
 \pi(x) = \pi(\phi(x)) = \pi(\phi(d))\pi(\phi(u)) \iff dU = \phi(d)U
 \iff d\phi(d)^{-1} \in U.
\]
Since $d, \phi(d) \in D$ we have $d\phi(d)^{-1} \in D \cap U = \{ I_2\}$ therefore $d\phi(d)^{-1} = I_2$, where $I_2$ is the identity in $\GL_2(\F_p)$.
Thus $d = \phi(d)$ and we conclude that any $\phi$ 
as in the statement is the same as an automorphism of~$U$ (extended to~$H$ by $\phi(d)=d$ for all $d\in D$). 

Write $N_B(U)$  for the normaliser of $U$ in $B$ and $C_B(U)$ for its centralizer. 
We have $N_B(U) = B$ 
and $C_B(U)$ are the matrices of the form $\left(\begin{smallmatrix}
                            \lambda & b \\
                            0 & \lambda
                            \end{smallmatrix} \right)$
with $\lambda \neq 0$. Thus $\# N_B(U)/C_B(U) = p-1$. 
Since  we also have 
\[
 N_B(U)/C_B(U) \hookrightarrow \Aut U \simeq \F_p^*
\]
it follows that $\Aut U \simeq N_B(U)/C_B(U)$, as desired.
\end{proof}

\begin{proposition} \label{P:fieldF}
Let $p > 2$ be a prime. Let $E/K$ be an elliptic curve such that 
$\rhobar_{E,p}$ is reducible. Assume there is an element of order~$p$ 
in the image of~$\rhobar_{E,p}$. 

Then, there is a field $F \supset K$ such that $[F : K] = p$ and $E$ acquires a 
second isogeny over~$F$.
\end{proposition}
\begin{proof} We can choose a basis of $E[p]$ where
\[
\rhobar_{E,p} =  \begin{pmatrix}
                            \chi& h \\
                            0 & \chi'
                            \end{pmatrix}.
\]

Let $H$ be the set of elements $\sigma \in  G_K$ such 
that $h(\sigma) = 0$. Since $\rhobar_{E,p}$ is a homomorphism it follows 
that $H$ is a subgroup of $G_K$. 
We let $F \subset K(E[p])$ to be the field fixed by $H$.
Since there is an element of order~$p$ in the image of~$\rhobar_{E,p}$ and 
$\left(\begin{smallmatrix}
                            \chi & 0 \\
                            0 & \chi'
                            \end{smallmatrix} \right)$
as order coprime to~$p$, 
it follows that $[F : K] =p$.
\end{proof}


\begin{theorem} \label{T:reducible}
Let $p > 2$ be a prime. Let $E_1, E_2$ be elliptic curves 
over~$K$ such that 
\begin{itemize}
 \item[(i)] $\rhobar_{E_1,p}^{ss} \simeq \rhobar_{E_2,p}^{ss} \simeq \chi \oplus \chi'$,  where $\chi, \chi' : G_K \to \F_p^*$ are characters;
 \item[(ii)] both $\rhobar_{E_1,p}$ and $\rhobar_{E_2,p}$ have an element of
 order~$p$ in the image.
\end{itemize}
After replacing $E_2$ by a $p$-isogenous curve if necessary, we have 
$\rhobar_{E_1,p} \simeq \rhobar_{E_2,p}$ 
if and only if $F_1 \simeq F_2$
where $F_i/K$ is a degree~$p$ extension where $E_i$ acquires a second isogeny
as given by Proposition~\ref{P:fieldF}.
\end{theorem}
\begin{proof} Clearly, 
if $\rhobar_{E_1,p} \simeq \rhobar_{E_2,p}$ 
then $F_1 \simeq F_2$. We now prove the opposite direction.

From (i) it follows that $\rhobar_{E_i,p}$ is reducible and that, after replacing $E_2$ by a $p$-isogenous curve if necessary (to swap 
$\chi$ with $\chi'$), 
we have 
\[
\rhobar_{E_i,p} =  \begin{pmatrix}
                            \chi & h_i \\
                            0 & \chi'
                            \end{pmatrix} \quad \text{ with } \quad  h_i : G_K \to \F_p.  
\]
Let $L$ be the field cut out 
by $\chi \oplus \chi'$. 
It follows from (ii) that $h_i|_{G_L} \neq 0$ 
hence the matrix $\left(\begin{smallmatrix}
                            1 & 1 \\
                            0 & 1
                            \end{smallmatrix} \right)$  
is in the image of $\rhobar_{E_i,p}$ for $i=1,2$.
                            
Write $K_i = K(E_i[p])$. 
We have $[K_i : K] = [K_i : L][L : K] = p [L : K]$. 
Since the degree $[L : K]$ divides $(p-1)^2$ it is coprime 
to $p = [F_i : K]$ therefore we have $K_i = L F_i$.

Suppose $F_1 \simeq F_2$. Since $K_1$ is Galois, we have $F_2 \subset K_1$ and therefore $K_p := K_1 = K_2$ is the field cut out by both
$\rhobar_{E_1,p}$ and $\rhobar_{E_2,p}$, i.e. these representations have the same kernel.

Write $G = \Gal(K_p / K)$. From now on we think of $\rhobar_{E_i,p}$ as an injective representation of~$G$. Note that the images of $\rhobar_{E_1,p}$ and $\rhobar_{E_2,p}$
is the same subgroup~$H$ of the Borel.

All the elements in $H$ are of the form $\rhobar_{E_2,p}(\sigma)$ for $\sigma \in G$, so we can consider the map $\phi = \rhobar_{E_1,p} \circ \rhobar_{E_2,p}^{-1} : H \to H$. It is an automorphism of~$H = D\cdot U$ satisfying the hypothesis of Proposition~\ref{P:inner}, where $D$ are 
the matrices $\left(\begin{smallmatrix}
                            \chi & 0 \\
                            0 & \chi'
                            \end{smallmatrix} \right)$.  
Then, $\phi$ is given by conjugation, that is
\[
 \phi(\rhobar_{E_2,p}(\sigma)) = A \rhobar_{E_2,p}(\sigma) A^{-1}.
\]
Since we also have
\[ 
\phi(\rhobar_{E_2,p}(\sigma)) 
=  \rhobar_{E_1,p} \circ \rhobar_{E_2,p}^{-1}(\rhobar_{E_2,p}(\sigma)) = \rhobar_{E_1,p}(\sigma)
\]
we conclude that $\rhobar_{E_1,p}(\sigma) = A \rhobar_{E_2,p}(\sigma) A^{-1}$, as desired.
\end{proof}

\section{The method to determine the symplectic type}\label{S:statistics}

In this section we discuss our systematic study of mod~$p$ congruences
between elliptic curves in the LMFDB database.  As of April 2019, this
database contains all elliptic curves defined over~$\Q$ of
conductor~$N\le\numprint{400000}$, as computed by the first author
using the methods of~\cite{AMEC}; there are $\numprint{2483649}$
curves, in $\numprint{1741002}$ isogeny classes.

Recall first that isogenous curves have mod~$p$ representations which
are isomorphic up to semisimplification, and actually isomorphic if
the degree of the isogeny is not divisible by~$p$.  Secondly, two
representations have isomorphic semisimplification if and only if they
have the same traces, so that we can test this condition by testing
whether
\[ a_{\ell}(E)\equiv a_{\ell}(E')\pmod{p}
\quad \text{for all primes } \ell \nmid pNN',
\] 
where $N$ and $N'$ are the conductors of $E$
and~$E'$ respectively.  This test can very quickly establish rigorously
that two curves do \emph{not} have isomorphic $p$-torsion up to
semisimplification, by finding  a single
prime~$\ell$ such that $a_{\ell}(E)\not\equiv a_{\ell}(E')\pmod{p}$.
Moreover, it is possible to prove that two curves have isomorphic $p$-torsion up to
semisimplification using this test for a finite number of
primes~$\ell$, as we explain in Step 2 below.

We divide our procedure to determine all mod~$p$ congruences between
non-isogenous curves, and their symplectic type, for a fixed
prime~$p$, into five steps.  We first outline the steps, and then
consider each in detail in the following subsections.
\begin{enumerate}[1.]
\item Partition the set of isogeny classes of elliptic curves in LMFDB
  into subsets~$S$, such that whenever two curves have mod~$p$
  representations with isomorphic semisimplifications, their isogeny
  classes belong to the same subset~$S$, but not necessarily
  conversely.
\item For each subset~$S$ prove that the curves in each isogeny class in~$S$ really
  do have isomorphic mod~$p$ representations up to
  semisimplification, if necessary further partitioning the subsets.
  Discard all ``trivial'' subsets of size~$1$.
\item Separate the remaining subsets resulting from the previous
  step into those which have irreducible mod~$p$ representations and
  the reducible ones.
\item For each irreducible subset~$S$, and each pair of isogeny
  classes in~$S$, pick curves $E$ and~$E'$, one from each class in the
  pair; determine the symplectic type of the triple~$(E,E',p)$; then
  use the isogeny criterion to partition the set of all the curves in
  all the isogeny classes in~$S$ into one or two parts such that curves
  in the same part are symplectically isomorphic while those in
  different parts are antisymplectically isomorphic.
\item For each reducible subset~$S$, determine whether, for each pair
  $E$, $E'$ chosen as in Step 4, there is an isomorphism between
  $E[p]$ and $E'[p]$ and not just between their semisimplifications,
  if necessary replacing $E'$ with the curve $p$-isogenous to it.  If
  not, this means that $E[p]$ and $E'[p]$ are not in fact isomorphic.
  Thus we further partition each reducible set $S$ into subsets of
  isogeny classes of curves whose mod~$p$ representations are actually
  isomorphic, not just up to semisimplification.  For each of these
  new subsets, if nontrivial, proceed as in Step~4.

\end{enumerate}
Next we will explain each step in further detail.  For the first three
steps, $p$ is arbitrary (and we have carried these steps out for $7\le
p\le23$) while for the last two we restrict to $p=7$. As remarked in
the Introduction, this is the most interesting case.
%% as there is a
%% considerable amount of congruences in both the reducible and
%% irreducible case; nevertheless, a similar method to the one we
%% describe below, using instead the classical equations for $X_E(3)$
%% or~$X_E(5)$ or the recent equations for $X_E(11)$ given by
%% Fisher~\cite{Fisher}, could be used to determine the symplectic type
%% of congruences modulo~$3$, $5$ or~$11$, respectively.


\subsection{Sieving}
In order that $E[p]\cong E'[p]$ (up to semisimplification) it is
necessary and sufficient that for all primes~$\ell$ not dividing
$pNN'$ we have $a_{\ell}(E)\equiv a_{\ell}(E')\pmod{p}$.  In this step
we may take one curve from each isogeny class, since isogenous curves
have the same traces~$a_\ell$, and have mod~$p$ representations with
isomorphic semisimplifications.

Fix an integer~$B\ge1$.  Let $\calL_B$ be the set of the $B$ smallest
primes greater than $\numprint{400000}$. All curves in the database
have good reduction at each prime in~$\calL_B$.  Assume also $B$ is
large enough that $p\notin\calL_B$.  Hence a necessary condition for
two curves $E$ and $E'$ in the database to be congruent mod~$p$ is
that $a_{\ell}(E)\equiv a_{\ell}(E')\pmod{p}$ for all~$\ell\in\calL_B$.

To each curve $E$ in the database we assign a ``hash value'' which is
a simple function of the set $\{a_{\ell}(E)\pmod{p}\mid
\ell\in\calL_B\}$.  For example we may enumerate
$\calL_B=\{\ell_0,\ell_1,\dots,\ell_{B-1}\}$ and use the integer value
$\sum_{i=0}^{B-1}\overline{a}_{\ell_i}(E)p^i$, where for $a\in\Z$,
$\overline{a}$ denotes the reduction of $a$ mod~$p$ which lies in
$\{0,1,\dots,p-1\}$.  Curves whose mod~$p$ representations are
isomorphic up to semisimplification will have the same hash, and we
may hope that clashes will be rare if $B$ is not too small.

We proceed to compute this hash value for one curve in each isogeny
class in the database, recording the curve's label in a list indexed
by the different hash values encountered.  At the end of this step we
can easily form a partition of the set of isogeny classes by taking
these lists for each hash value.  We then discard any such lists which
are singletons.

{\bf Example.} With $p=7$ and $B=30$, it take approximately 30 minutes to
compute the hash of one curve in each isogeny class in the database.
The result consists of $20138$ nontrivial subsets.  With $p=11$ and
$B=30$ there are $636$ nontrivial subsets.

\subsection{Proving isomorphism up to semisimplification}

For each of the pairs of isogeny classes obtained in the previous step
we use a criterion of Kraus--Oesterl\'e (see \cite[Proposition~4]{KO}),
based on the Sturm bound and hence on the modularity of elliptic curves
over~$\Q$, to either prove isomorphism up to
semisimplification, or reveal a ``false positive''.  The latter
happens when two curves which are not congruent mod~$p$ have traces of
Frobenius~$a_{\ell}$ which are congruent modulo~$p$ for
all~$\ell\in\calL_B$.

{\bf Example (continued).} After running Step~1 using $B=30$ for $p=7$, of the $20138$
nontrivial subsets found there is only one ``false positive''.  One of
the subsets found in Step~1 is
\[
S = \{ \lmfdbec{25921}{a}{1},
\lmfdbec{78400}{gw}{1},
\lmfdbec{336973}{z}{1},
\lmfdbec{336973}{ba}{1}
\};
\]
however, curve \lmfdbec{25921}{a}{1} is not in fact
mod~$7$ isomorphic to the other three, while the others do form a
genuine triple of curves which have mutually isomorphic mod~$7$
representations up to semisimplification.
Thus, we subdivide the set $S$ above into 
\[
\{ \lmfdbec{25921}{a}{1} \}, \quad 
\{ \lmfdbec{78400}{gw}{1},
\lmfdbec{336973}{z}{1},
\lmfdbec{336973}{ba}{1}
\}
\]
and discard the first one as it is a singleton; the remaining~$20138$
subsets have sizes between~$2$ and~$76$.

For $p=11$ and $B=30$, there is also just one false positive
nontrivial subset, namely $\{ \lmfdbec{25921}{a}{1} ,
\lmfdbec{78400}{gw}{1}\}$.  So there are $635$ genuine nontrivial
subsets, each consisting of just two isogeny classes, all of which
have irreducible mod~$11$ representations.  
%{\bf Up to twist, there are
%only $89$ distinct subsets.}

\begin{remark}
Note that the false positive pairs for $p=7$ and $p=11$ are the same.
These false positives arise since \lmfdbec{25921}{a}{1} and
\lmfdbec{78400}{gw}{1} have $a_{\ell}$ which are \emph{equal} for
all~$\ell\in\calL_{30}$, and even all~$\ell\in\calL_{35}$.  (Both
these curves have CM by the order of discriminant~$-7$, so in fact
both have $a_\ell=0$ for all $\ell\equiv3,5,6\pmod{7}$.) In this case,
using any $B\ge36$ instead would have eliminated the false positives,
but then Step~1 would have taken longer.  In fact, even for the small
prime $\ell=29$ the values of $a_{\ell}$ for these curves are $+2$
and~$-2$, which are not congruent modulo any odd prime.

\end{remark}


\subsection{Testing reducibility}
For each set  of isogeny classes of curves
obtained in the previous step, we determine whether the curves in the
set have irreducible or reducible mod~$p$ representations.  To do
this we apply a standard test of whether an elliptic curve admits a
rational $p$-isogeny.  For the curves in the database this information
is already known.

{\bf Example (continued).} For $p=7$, of the 20138 nontrivial sets from Step~2, we
find that 19883 are irreducible, {\it i.e.}\@ consist of curves whose
mod~$7$ representations are irreducible, while 255 are reducible.

The irreducible sets have size at most~$5$.  In detail, there are
18334 sets of size~2; 1297 sets of size~3; 246 sets of size~4; and 6
sets of size~5.

The reducible sets have size up to~$76$.  In Step~5 below we will
further partition these sets after testing whether the curves are
actually congruent mod~7 (not just up to semisimplification).

%% Reducible {2: 86, 3: 67, 4: 31, 5: 26, 7: 7, 10: 6, 6: 5, 8: 5, 9: 4, 19: 4, 11:
%%   3, 16: 2, 18: 2, 32: 1, 35: 1, 76: 1, 13: 1, 14: 1, 45: 1, 36: 1}

For $p=11$, the 635 nontrivial subsets are all of size~2, and
all are irreducible.


\subsection{Distinguishing symplectic from antisymplectic: irreducible case}
After the previous step we have a collection of sets of isogeny
classes, such that for each pair of curves $E$, $E'$ taken from
isogeny classes in each set, the $G_{\Q}$-modules $E[p]$ and $E'[p]$
are isomorphic and irreducible. Moreover, from
\cite[Corollary~3]{FKSym} we know that all isomorphisms $\phi : E[p]
\simeq E'[p]$ have the same symplectic type. We wish to determine
whether this type is symplectic or anti-symplectic.  We may assume
that $E$ and~$E'$ are not isogenous, as otherwise we may simply apply
the isogeny criterion.

The local criteria of \cite{FKSym} suffice to determine the symplectic type for all the mod~$p$ congruences found in
the database for $p=7$ and $p=11$ (actually, for all $7 \leq p \leq 17$), but this does not have to be the case as discussed in Section~\ref{S:motivation} (see \cite[Proposition~16]{FKSym} for an example with $p=3$ where the local methods fail).
Therefore, we will now describe a procedure, using the modular curves~$X_E(7)$, to obtain a method that works in all cases. 
We will use the
modular parametrizations and explicit formulae of Kraus--Halberstadt~\cite{Halberstadt-Kraus-XE7}, Poonen--Schaefer--Stoll~\cite{PSS}, and as extended and completed by Fisher~\cite{Fisher}. 

In~\cite{Halberstadt-Kraus-XE7}, Halberstadt and Kraus
give an explicit model for the modular curve $X_E(7)$, for any
elliptic curve $E$ defined over a field~$K$ of characteristic not
equal to $2$, $3$ or~$7$. The $K$-rational points on $X_E(7)$
parametrize pairs $(E',\phi)$ where $E'$ is an elliptic curve defined
over~$K$ and $\phi:E[7]\to E'[7]$ is a symplectic isomorphism of
$G_K$-modules; we  identify two such isomorphisms~$\phi$ when one
  is a scalar multiple of the other.

The model for $X_E(7)$ given in \cite{Halberstadt-Kraus-XE7} is a
plane quartic curve, a twist of the classical Klein quartic~$X(7)$,
given by an explicit ternary quartic form~$F_{a,b}(X,Y,Z)$ in
$\Z[a,b][X,Y,Z]$ where $E$ has equation $Y^2=X^3+aX+b$.  The $24$
flexes on $X_E(7)$ are the cusps, that is, they are the poles of the
degree~$168$ map to the $j$-line.
%% The $28$ bitangents intersect $X_E(7)$ at the 56
%% points above $j=0$: these are the intersection points of $X_E(7)$ and
%% the curve of degree~$14$ defined by a covariant of~$F_{a,b}$.

The base point $P_E=[0:1:0]\in X_E(7)(K)$ corresponds to the pair
$(E,\id)$.  In \cite{Halberstadt-Kraus-XE7} one can also find explicit formulas
for the rational function $j:X_E(7)\to X(1)$ and for the elliptic curve~$E'$
associated with all 
but finitely many points $P=(x:y:z)\in
X_E(7)$. More precisely, 
explicit polynomials $c_4, c_6 \in \Z[a,b][X,Y,Z]$
of degree~$20$ and~$30$, respectively, are given and the curve $E'$ associated with (all but finitely many)~$P$ has model
\[Y^2=X^3-27c_4(P)X-54c_6(P).\]

The finitely many common zeros of $c_4$
and $c_6$ are the exceptions, which Kraus and Halberstadt treat only
incompletely.  However, in \cite{Fisher} one may find formulas for
four such pairs of polynomials~$(c_4,c_6)$, of which the first is the pair in
\cite{Halberstadt-Kraus-XE7}, and such that at each point $P\in
X_E(7)$ at least one pair $(c_4(P),c_6(P))\not=(0,0)$, thus supplying
us with a model for the associated elliptic 
curve~$E'$ at each point~$P$.

We make use of this model and formulas as follows, given 
curves $E$, $E'$ with $E[7]\cong E'[7]$.  Using one curve~$E$ we write
down the model for $X_E(7)$. 
Then we find all preimages (if any) of
$j(E')$ under the map $j:X_E(7)\to X(1)$.  While in principle (over an
algebraically closed field) there may be as many as $168$ preimages,
over $\Q$ {\bf there are at most two}. 
If there are no preimages we conclude that the
isomorphism $E[7]\cong E'[7]$ is not symplectic.  Otherwise, for each
preimage $P\in X_E(7)(\Q)$ we compute the curve associated to~$P$,
which is certainly a twist of~$E'$, and test whether it is actually
isomorphic to $E'$.  If this holds for one such point~$P$ in the
preimage of $j(E')$, then the isomorphism between
$E[7]$ and $E'[7]$ is symplectic.

A similar method may be applied to test for antisymplectic
isomorphisms, using another twist of $X(7)$ denoted $X_E^-(7)$, first
written down explicitly in \cite{PSS}, for which Fisher provides
explicit formulae for the $j$-map and $c_4,c_6$ as above
in~\cite{Fisher}.

We note that it is not necessary to apply both the symplectic and
antisymplectic tests to a triple $(E,E')$ if we know already that
$E[7]\cong E'[7]$ as $G_\Q$-modules, since one will succeed if and only if the other
fails (by remarks made in the Introduction).  However we did apply both
tests in our computations with the curves in the database as a test of
our implementation, verifying that precisely one test passes for each
pair.  We also checked that the results obtained for each pair using
the local criteria are the same, so that we can be confident in the
correctness of the results.

These tests have only been carried out using a single curve in each
isogeny class, since we know how to distinguish symplectic from
antisymplectic isogenies.  As a last step, we consider the full isogeny classes
to obtain, for each elliptic curve~$E$ in the database, the complete sets of all curves~$E'$ (non-isogenous to~$E$) which have
symplectically and anti-symplectically isomorphic $7$-torsion modules to~$E$.

The output of this step consists of, for each of the subsets resulting
from Steps~1--3, one or two sets of curves whose union is the set of
all curves in the isogeny classes in the subset.  All curves in the
same set have symplectically isomorphic 7-torsion modules; when there
are two sets, curves in different sets have antisymplectically
isomorphic 7-torsion.

\begin{example}
One of the subsets resulting from Steps 1--3 consists of the pair of
isogeny classes $\{\lmfdbec{344025}{bc}{1},
\lmfdbec{344025}{bd}{1}\}$.  Our test shows that
$\lmfdbec{344025}{bc}{1}$ and $\lmfdbec{344025}{bd}{1}$ are
symplectically isomorphic.  The isogeny class
$\lmfdbeciso{344025}{bc}$ contains two $2$-isogenous curves, while
class $\lmfdbeciso{344025}{bd}$ contains only one curve.  Since $2$ is
a quadratic residue mod~7, all three curves have symplectically
isomorphic 7-torsion, and hence Step~4 returns a single set
\[\{\lmfdbec{344025}{bc}{1}, \lmfdbec{344025}{bc}{2}, \lmfdbec{344025}{bd}{1}\}.\]
Another subset resulting from Steps 1--3 is
$\{\lmfdbec{100800}{gw}{1}, \lmfdbec{100800}{hc}{1}\}$.  The same
procedure results in the output of two sets of curves
\[
\{\lmfdbec{100800}{gw}{1}\}, \qquad \{\lmfdbec{100800}{hc}{1},
\lmfdbec{100800}{hc}{2}\},
\]
since our tests show that $\lmfdbec{100800}{gw}{1}$ and
$\lmfdbec{100800}{hc}{1}$ are antisymplectically isomorphic, and the
last two curves are $2$-isogenous.
\end{example}

\begin{remark}
A similar method to the one just described but using the
classical equations for $X_E(3)$ or~$X_E(5)$ or the recent equations for $X_E(11)$ given by Fisher~\cite{Fisher} 
could be used to determine the symplectic type of 
congruences modulo~$3$, $5$ or~$11$, respectively.
\end{remark}

\subsection{Distinguishing symplectic from antisymplectic: reducible
  case}

One additional complication arises in this case.  
Indeed, from Steps 1--3 we have 
$E[7]^{\sss} \simeq E'[7]^{\sss}$ but this is insufficient to conclude $E[7] \simeq E'[7]$ as when these are reducible $G_\Q$-modules . 
To achieve this we will apply Theorem~\ref{T:reducible} and its proof.

Recall that $E[7]$
is reducible if and only if $E$ admits a rational $7$-isogeny.  Over
$\Q$ there is only ever at most one $7$-isogeny, since otherwise the
image of the mod~$7$ representation~$\rhobar_{E,7}$ attached to~$E$ is contained in
a split Cartan subgroup of $\GL(2,\F_7)$, and this cannot occur
over~$\Q$ (see~\cite[Theorem~1.1]{GL}). 
Furthermore, it is well known that the size of the $\Q$-isogeny class of~$E$ is either $2$, consisting of two $7$-isogenous curves,
or $4$, consisting of two pairs of $7$-isogenous curves linked by
$2$-{} or $3$-isogenies. (Examples of these are furnished by the
isogeny classes \lmfdbeciso{26}{b}, \lmfdbeciso{49}{a}, and
\lmfdbeciso{162}{b} respectively.) 

Fix an elliptic curve $E$ with $E[7]$ reducible. 
The image
of~$\rhobar_{E,7}$ has the form
\[
  \begin{pmatrix}\chi_1&*\\0&\chi_2  \end{pmatrix},
\]
where~$\chi_1, \; \chi_2 : G_{\Q}\to\F_7^*$ are characters  and $* \neq 0$ by the previous discussion. Moreover, the product $\chi_1\chi_2$ is the cyclotomic
character, so in particular $\chi_1\not=\chi_2$ (this observation
being valid over any field not containing $\sqrt{-7}$, so that the
determinant is not always a square).

Now let $E'$ be a second curve such that $E[7]^{\sss}\cong
E'[7]^{\sss}$. 
The image of $\rhobar_{E',7}$ has the form
\[
  \begin{pmatrix}\chi_1'&*'\\0&\chi_2'  \end{pmatrix},
  \]
where $\{\chi_1,\chi_2\}=\{\chi_1',\chi_2'\}$
and $*' \neq 0$ by the same reason as above.
In particular, there is an element of order~$7$ in the image of both $\rhobar_{E,7}$ and $\rhobar_{E',7}$; the next step in applying Theorem~\ref{T:reducible} is to decide if we need to replace $E'$ with its $7$-isogenous curve. For this we determine the characters
$\chi_1'$ and $\chi_2'$: for
example, the kernel of $\chi_1$ cuts out the cyclic extension of~$\Q$
of degree dividing~$6$ generated by the coordinates of a point in the
kernel of the unique $7$-isogeny from~$E$. 
In this way we can
determine whether $\chi_1=\chi_1'$ and $\chi_2=\chi_2'$ or $\chi_1=\chi_2'$ and $\chi_2=\chi_1'$.
In the second case, we replace $E'$ with its $7$-isogenous curve,
which has the effect of interchanging $\chi_1'$ 
and~$\chi_2'$ (as well
as changing $*'$).  Now the image of $\rhobar_{E',7}$ has the form
\[
\begin{pmatrix}\chi_1&*'\\0&\chi_2  \end{pmatrix},
\]
with the same characters, in the same order as for $\rhobar_{E,7}$. From Theorem~\ref{T:reducible} we have that 
$E[7]\cong E'[7]$ if and only if $F_1 \simeq F_2$, where $F_i$ are the fields in the statement of that theorem. 

%{\bf Although the maps $*,*':G_{\Q}\to\F_7$ are not homomorphisms, it is
%easy to check that they are both surjective and that the subsets of
%$G_{\Q}$ which map to~$0$ under each (which by abuse of language we
%will call the \emph{kernels} of~$*$ and~$*'$) are subgroups, of
%index~$7$ and cutting out cyclic extensions} of~$\Q$ of degree~$7$.

The field $F_1$ is
the field of definition of the other seven $7$-isogenies from~$E$ (see also Proposition~\ref{P:fieldF}).
The map from $X_0(7)$ to the $j$-line is given by the classical rational function (see Fricke~??)
\[
   j = \frac{(t^{2} + 13t + 49) \cdot (t^{2} + 5t + 1)^{3}}{t},
\]
where $t$ is a choice of Hauptmodul for the genus~$0$ curve $X_0(7)$. Hence the roots of the degree~$8$ polynomial~$(t^{2} + 13t + 49) \cdot
(t^{2} + 5t + 1)^{3} -t\cdot j(E)$ determine the fields of definition of the eight $7$-isogenies from~$E$. In our setting, it has a single
root (giving the unique $7$-isogeny from~$E$) and an irreducible
factor of degree~$7$, which defines~$F_1$ as an abstract field. Similarly, starting from $E'$ we determine $F_2$; finally, we check weather $F_1$ and $F_2$ are isomorphic.

%the desired extension of the base
%field~$\Q$, which in turn  uniquely identifies the $*$ component of the
%representation, by Theorem~\ref{T:reducible}.

In this way, for each pair $(E,E')$ whose 
mod~$7$ representations
are reducible with isomorphic semisimplifications, we may determine
whether or not we do in fact have an isomorphism $E[7]\cong E'[7]$,
possibly after replacing $E'$ by its unique $7$-isogenous curve.

In most of the reducible cases encountered in the database, we found
that there was no isomorphism between the $7$-torsion modules
themselves.  In those cases where there is such an isomorphism, we can
determine whether or not is is symplectic using the same methods as in
the previous step, noting that the test using the parametrizing curves
$X_E(7)$ and $X_E^-(7)$ do not at any point rely on the irreducibility
or otherwise of the representations.  Finally, if there are also
$2$-{} or $3$-isogenies present we can include these appropriately,
since the former are symplectic and the latter antisymplectic.

{\bf Example (continued).} For $p=7$, after Steps 1--3, there are~?? reducible pairs with isomorphic semisimplification. Out of these, after Step~5, we get~?? pairs which admit
an isomorphism of the whole $7$-torsion modules. 
Finally, after considering all the isogenous curves (as in Step~4) there are 421 congruent pairs: 
262 symplectic and 159 antisymplectic. 

For $p=11$ there are no reducible pairs to consider.

\section{The case of image equal to normaliser of Cartan}

Let $p$ be a prime. Fix $\zeta_p \in \Qbar$ a $p$-th primitive root of
unity.  Given an elliptic curve $E$ over a number field $K$, write
$E[p]$ for its $p$-torsion $G_K$-module. Let $e_{E,p}$ denote the Weil
pairing in $E[p]$ and $\rhobar_{E,p} : G_K \to \GL_2(\F_p)$ the Galois
representation arising from $E[p]$.

When $\rhobar_{E,p}$ has image $N \subset \GL_2(\F_p)$, the normaliser
of a Cartan subgroup~$C$ (either split or non-split), it induces a
non-trivial quadratic character
\[
 \eps \; : G_K \to N \twoheadrightarrow N/C \simeq \{\pm 1 \}
\]
and we write $K(\sqrt{d})$ for the quadratic extension cut out
by~$\eps$.

\begin{theorem} \label{T:Cartan}
Let $p > 2$ be a prime. Let $E/K$ be an elliptic curve 
over a number field $K$. Assume that $\rhobar_{E,p}$ has image~$N
\supset C$ as above, and let $E^d$ be the quadratic twist of $E$
by~$d$.

Then $E[p]$ and $E^d[p]$ are isomorphic $G_K$-modules. Moreover, any
such isomorphism is symplectic if and only if $C$ is split and $p
\equiv 1 \pmod{4}$, or $C$ is non-split and $p \equiv 3 \pmod{4}$; and
anti-symplectic otherwise.
\end{theorem}

\begin{proof} We first prove that $E[p] \simeq E^d[p]$ as $G_K$-modules. 
Note that $\rhobar_{{E^d}, p} = \rhobar_{E, p} \otimes \eps$, and
hence for all $\sigma \in G_K$ we have
\[\Tr \rhobar_{{E^d},p}(\sigma) = \eps(\sigma) \cdot \Tr \rhobar_{E,p}(\sigma).\]

Note that, if $\eps(\sigma) = -1$ then $\rhobar_{E,p}(\sigma) \in N\backslash C$ and $\Tr \rhobar_{E,p}(\sigma) = 0$, so also $\Tr \rhobar_{E^d,p}(\sigma) = 0$;
therefore, $\Tr \rhobar_{E,p}(\sigma) = \Tr \rhobar_{E^d,p}(\sigma)$ 
for all $\sigma \in G_K$. Since these representations are irreducible and have
the same traces it follows that they are isomorphic.

From the hypothesis on the image of $\rhobar_{E,p}$ we can 
choose a basis $P_1, P_2$ of $E[p]$ such that $\rhobar_{E,p}$ has image 
the subgroup of $\GL_2(\F_p)$ given by 
\[
\left\{ 
\begin{pmatrix}
a & b\delta \\
b & a
\end{pmatrix}, 
\begin{pmatrix}
a & b\delta \\
-b & -a
\end{pmatrix}  \; : a, b \in \F_p, \; a^2 - \delta b^2 \neq 0 \right\},
\]
where $\delta \in \F_p^*$ is a (fixed) square if $C$ is split and a
non-square if $C$ is non-split. Furthermore, for $\sigma \in G_K$, we
have
\[
 \rhobar_{E,p}(\sigma) = \begin{cases} 
                            \begin{pmatrix}
                            a & b\delta \\
                            b & a
                            \end{pmatrix} \quad \text{ if } \eps(\sigma) = 1,  \\
\begin{pmatrix}
a & b\delta \\
-b & -a
\end{pmatrix} \quad \text{ if } \eps(\sigma) = -1.  \\
\end{cases}\]
Fix $\tau \in G_K$ such that 
\[
 \rhobar_{E,p}(\tau) =  \begin{pmatrix}
                            1 & 0 \\
                            0 & -1
                            \end{pmatrix},
\]
so that  $\tau(P_1) = P_1$, $\tau(P_2) = -P_2$ and 
$\rhobar_{E,p}(G_K) = N = \langle C,\rhobar_{E,p}(\tau) \rangle$.

The map from $E$ to $E^d$ given by
$(x,y) \mapsto (dx,d\sqrt{d}y)$ becomes 
an isomorphism over $K(\sqrt{d})$. 
Let $\tw : E[p](\Qbar) \to E^d[p](\Qbar)$ be the map on $p$-torsion points induced by it. 
With a direct calculation we see
that
\begin{equation} \label{E:eps}
 \tw(\sigma(P)) = \eps(\sigma)\cdot\sigma(\tw(P)) \quad \text{ for all } \sigma \in G_K 
 \text{ and all } P \in E[P]. 
 \end{equation}
We now consider the linear
map $\phi : E[p] \to E^d[p]$ defined on the basis by
\[
 \phi(P_1) = \tw (P_2) \quad \text{ and } \quad   \phi(P_2) = \delta \tw (P_1),
\]
and will show it is $G_K$-equivariant, i.e. $\sigma(\phi(P)) =
\phi(\sigma(P))$ for all $\sigma \in G_K$ and $P \in E[P]$. Write $P_i
= (x_i,y_i)$. Since $\eps(\tau) = -1$, we have
\[
 \tau(\phi(P_1)) = \tau(\tw(P_2)) = -\tw(\tau(P_2)) = -\tw (-P_2) = \phi(P_1) = \phi(\tau(P_1)),
\]
where in the second inequality we used~\eqref{E:eps}; also,
\[
 \tau(\phi(P_2)) = \tau(\delta \tw(P_1)) = -\delta \tw(\tau(P_1)) = 
  -\delta \tw(P_1) = -\phi (P_2) = \phi(\tau(P_2)).
\]
Recall that for $\sigma \in G_K$ such that $\rhobar_{E,p}(\sigma) \in C$, we have
$\eps(\sigma) = 1$ and
\[
 \rhobar_{E,p}(\sigma) =  \begin{pmatrix}
                            a & b\delta \\
                            b & a
                            \end{pmatrix}.
\]
Therefore, equation~\eqref{E:eps} 
gives $\tw(\sigma(P_i)) = \sigma(\tw(P_i))$ and we have
\[
 \sigma(\phi(P_1)) = \sigma(\tw(P_2)) = \tw (\sigma (P_2)) 
 = \tw (\delta b P_1 + a P_2) = \delta b \tw (P_1) + a\tw(P_2) = b \phi(P_2) + a \phi(P_1)
\]
and
\[
 \sigma(\phi(P_2)) = \delta \sigma(\tw(P_1)) = \delta \tw (\sigma (P_1)) 
 = \delta \tw (a P_1 + b P_2) = a \phi(P_2) + b \delta \phi(P_1) = \phi(\sigma(P_2)),
\]
as desired. Finally, we note that 
\[
 e_{E^d,p}(\phi(P_1),\phi(P_2)) = e_{E^d,p}(\tw (P_2),\delta \tw(P_1)) 
 =  e_{E^d,p}(\tw (P_1), \tw (P_2))^{-\delta} =  e_{E,p}(P_1,P_2)^{-\delta}, 
 \]
where the last equality holds since $\tw$ preserves the Weil pairing.
Thus $\phi$ is symplectic if and only if $(-\delta/p) = 1$.
\end{proof}

\begin{remark}\label{R:CM}
The hypotheses of the theorem hold when $K=\Q$, $E$ has CM, and $p$ is
unramified in the CM field~$\Q(\sqrt{d})$.  In this case, $\eps$ is
the quadratic character associated to the CM field.  The twist $E^d$
is isogenous to~$E$ by an isogeny of degree~$|d|=-d$, and it is easy to
see that the conclusion of the theorem holds in this case since $C$ is
split or nonsplit according to whether $(d/p)=+1$ or $-1$ respectively.
\end{remark}

\begin{remark}
In our computed data, most of the time, we do not see isomorphism arising from CM curves as in the previous remark. This is because 
(apart from the CM fields where quartic or sextic twists occur) all such mod~$p$ isomorphisms occur within an isogeny
class, and we have omitted these from consideration. 
\end{remark}


\section{Mod $7$ isomorphisms between elliptic curves with 
$j$-invariant~$0$}
In this section, we will show that for every elliptic curve~$E$ with $j(E)=0$, there is a
non-trivial sextic twist of~$E$ which has symplectically isomorphic
mod-$7$ Galois representation.

Every elliptic curve with $j=0$ has a model of the form
$E_b:\ Y^2=X^3+b$ with $b$ nonzero, and the isomorphism class of $E_b$
depends only on $b$ modulo $6$th powers.  Any two such curves are
sextic twists of each other: the sextic twist of $E_b$ by $u$ is
$E_{bu}$, which is isomorphic to $E_b$ if and only if $u$ is a $6$th
power.  We will prove the following:

\begin{theorem}\label{T:j=0}
For every $b\not=0$, the elliptic curves $E_b$ and $E_{-28/b}$ have
symplectically isomorphic mod-$7$ Galois representations.
\end{theorem}

For simplicity of notation we take the base field to be $\Q$.  Little
change would be required in what follows if $\Q$ were to be replaced
by any field of characteristic different from~$2$, $3$ or $7$ in which
$-3$ is not a square.  In case $-3$ is a square there is some
simplification, and the result still holds.

We fix some notation. 
Let $K=\Q(\r3)=\Q(\w)$ where $\w$ satisfies
$\w^2+\w+1=0$, so that $\w$ is a primitive $3$rd root of
unity and $-\w$ a primitive $6$th root of unity.  The
curves $E_b$ have CM by the maximal order~$\OO_K=\Z[\w]$ in which
$7$ splits as $7=\pi\pibar$ where $\pi=3\w+2$.  Set
$\r3=2w+1$ (to fix the sign).  We denote the nontrivial
automorphism of $K/\Q$ by $x\mapsto x'$.

Fix $b\in\Q^*$ defining the elliptic curve $E_b: Y^2=X^3+b$.  The
$2$-dimensional $\F_7$-vector space~$E_b[7]$ has two $K$-rational
one-dimensional subspaces, namely the kernels of the endomorphisms
$[\pi]$ and $[\pibar]$, which we make explicit.

Define
\begin{align}
\alpha&=4b/\pibar,\\
\beta=\alpha+b&=-\w^2\r3^3b/\pibar,\quad\text{and}\\
\gamma&=-4\r3^3b/\pibar = -\r3^3\alpha = 4\w\beta.
\end{align}
Note that, for any choice of roots~$\alpha^{1/3}$ and~$\beta^{1/2}$, the point $(\alpha^{1/3},\beta^{1/2})$ is 
in~$E_b(\Qbar)$.  We fix one $6$th 
root~$\gamma^{1/6}$ once and for all
and set
\begin{align}
\alpha^{1/3} &= \gamma^{1/3}/\r3,\\
\beta^{1/2} &= \gamma^{1/2}\w/2
\end{align}
(with $\gamma^{1/3}=(\gamma^{1/6})^2$ and $\gamma^{1/2}=(\gamma^{1/6})^3$).  Let
$P=(\alpha^{1/3},\beta^{1/2})\in E_b(\Qbar)$.

Computing the $7$-division polynomial of~$E_b$, we find that over
$\Q(b)$ (treating $b$ as an indeterminate) it has factors $X^3-\alpha$
and $X^3-\alpha'$, the remaining factor of degree~$18$ being
irreducible.  It follows that $P$ and the conjugate point
$P'=(\alpha'^{1/3},\beta'^{1/2})$ have order~$7$.  Also, the multiples
$kP$ for $1\le k\le6$ all have $x(kP)^3=\alpha$ (this can be checked
by direct calculation, or by observing that $x(2P)^3=\alpha'$ yields a
contradiction after repeating three times since $8P=P$).

Thus the $7$-division field of~$E_b$ is
$L=K(E_b[7])=K(P,P')=K(\gamma^{1/6},\gamma'^{1/6})$.

\begin{lemma}In all cases, $\gamma$ and~$\gamma'$ are independent in
  $K^*/K^*{}^2$.  They are independent in $K^*/K^*{}^3$ unless
  $b=2\cdot7^2\cdot c^3$ with~$c\in\Q^*{}^3$, in which case
  $\gamma\gamma'=(-42c)^3$ and they generate a subgroup of $K^*/K^*{}^3$
  of order~$3$.

In the first case we have $\Gal(L/K)\cong(\Z/6\Z)^2$.  In the second
case, $\Gal(L/K)\cong(\Z/6\Z)\times(\Z/2\Z)$.
\end{lemma}
\begin{proof}
Elementary.
\end{proof}
Note that $b=2\cdot7^2\cdot c^3 = 98c^3\implies -28/b=98(-7c)^3$, so the situation is
symmetric between $E_b$ and $E_{-28/b}$.  In this case, the curves
$E_b$ and $E_{-28/b}$ are not just sextic twists but quadratic twists
by $-7$, since $-28/b^2=(-7)^3/c^6$.

\subsection{Proof: generic case}

To start with, we assume that we are not in the special case, so that
$\Gal(L/K)\cong(\Z/6\Z)^2$.  We will define generating
automorphisms~$\sigma_1$, $\sigma_2\in\Gal(L/K)$, each of order~$6$, together
with an automorphism~$\tau$ of order~$2$ in $\Gal(L/\Q)$ such that
$\Gal(L/\Q)=\left<\sigma_1,\sigma_2,\tau\right>$.

Fix one value of $\gamma^{1/6}$ arbitrarily.  Let $\tau\in\Gal(L/\Q)$
be an element of order~$2$ restricting to the non-trivial element of
$\Gal(K/\Q)$.  Then $(\tau(\gamma^{1/6}))^6=\tau(\gamma)=\gamma'$, so
we may fix the value of $\gamma'^{1/6}$ by setting
$\gamma'^{1/6}=\tau(\gamma)$.  Now by independence of $\gamma^{1/6}$
and $\gamma'^{1/6}$ there exists $\sigma_1\in\Gal(L/K)$ fixing
$\gamma'^{1/6}$ and mapping $\gamma^{1/6}\mapsto-w\gamma^{1/6}$ (recall
that $-w$ is a primitive $6$th root of unity) and also
$\sigma_2\in\Gal(L/K)$ fixing $\gamma^{1/6}$ and mapping
$\gamma'^{1/6}\mapsto-w^2\gamma'^{1/6}$.

Both $\sigma_1$ and~$\sigma_2$ multiply $(\gamma/\gamma')^{1/6}$ by
the same $6$th root of unity, $-w$.  Note that
$\gamma/\gamma'=-\pi/\pibar$; one may check that
$K((\gamma/\gamma')^{1/6})=K(\zeta_7)$, and that both $\sigma_1$ and
$\sigma_2$ map $\zeta_7$ to $\zeta_7^3$.  (The image must be either
$\zeta_7^3$ or $\zeta_7^5$ since $3$ and $5$ are the primitive roots
modulo~$7$.)

Recall that $P=(\alpha^{1/3},\beta^{1/2})\in E_b(K(\gamma^{1/6}))$ is
fixed by our choice of $\gamma^{1/6}$.  We similarly have
$P'=(\alpha'^{1/3},\beta'^{1/2})\in E_b(K(\gamma'^{1/6}))$, and~$\tau$
interchanges these.  Hence we have
\[
   \rho_{E_b,7}(\tau) = \begin{pmatrix}0&1\\1&0   \end{pmatrix}.
\]


Now $\sigma_1$ fixes~$P'$, while one may see that $\sigma_1(P)=3P$
(for example the standard formulas for adding points show that
$-2P=(w^{-5}\alpha^{1/3},\beta^{1/2})=\sigma_1^5(P)$); this also
follows from the action on the $7$th roots of unity noted above, which
implies that the determinant of the matrix giving the action of
$\sigma_1$ on $\left<P,P'\right>$ is $3\pmod7$.  This matrix is
therefore
\[
   \rho_{E_b,7}(\sigma_1) = \begin{pmatrix}3&0\\0&1   \end{pmatrix},
\]
and similarly
\[
   \rho_{E_b,7}(\sigma_2) = \begin{pmatrix}1&0\\0&3   \end{pmatrix}.
\]

Now we consider the effect of twisting~$E_b$ by $u=-28/b^2$.
Replacing $b$ by $ub=-28/b$ changes $\gamma$ into $(2\r3)^6/\gamma'$.
In fact we started out by looking for a sextic twist~$u$ which induces
an isomorphism on the $7$-torsion modules, which must have the effect
of replacing $\gamma$ by $\gamma^{\pm1}$ or~$\gamma'^{\pm1}$, modulo
$6$th powers.  The only solutions with $u\in\Q^*$ are $u=-27$ and
$u=-28/b^2$.

Hence the twist leaves the $7$-division field
$K(\gamma^{1/6},\gamma'^{1/6})$ unchanged, which is certainly
necessary.

The twisting map~$\tw$ takes $(x,y)\in E_b$ to $(u^{1/3}x,u^{1/2}y)\in
E_{bu}$.  Again we need to fix the roots.  We set
$u^{1/6}=2\r3/(\gamma^{1/6}\gamma'^{1/6})$, then
$u^{1/3}=-12/(\gamma^{1/3}\gamma'^{1/3})$ and
$u^{1/2}=8\r3^3/(\gamma^{1/2}\gamma'^{1/2})$.  Hence
\[
 \tw(P) = (u^{1/3}\alpha^{1/3},u^{1/2}\alpha^{1/2}) =
(4\r3/\gamma'^{1/3},-4w\r3^3/\gamma'^{1/2}),
\]
which is fixed by~$\sigma_1$ and taken to $3$ times itself
by~$\sigma_2$.  Similarly, $\sigma_2$ fixes $\tw(P')$ and
multiples~$\tw(P)$ by~$3$.

Now $\tau$ fixes $u^{1/3}$ and negates $u^{1/2}$. A simple calculation
then gives $\tau(\tw(P)) = -\tw(P')$.

Now define $\phi: E_b[7] \to E_{bu}[7]$ by $P\mapsto\tw(P')$,
$P'\mapsto-\tw(P)$.  Then $\phi$ commutes with the action of
$\sigma_1$, $\sigma_2$ and~$\tau$, so is an isomorphism of
$G_\Q$-modules.  It is also symplectic:  denoting the Weil pairing by
$e_7$ we have
\[
e_7(\phi(P),\phi(P')) = e_7(\tw(P'),-\tw(P)) = e_7(P',-P) =
e_7(P',P)^{-1} = e_7(P,P'),
\]
where we have used the fact that $\tw$, being an isomorphism defined
over $\overline{\Q}$ preserves the Weil pairing.

This completes the proof that $E_b[7]$ and $E_{-28/b}[7]$ are
isomorphic as symplectic $G_{\Q}$-modules in the case where $b\notin
2\cdot7^2\cdot \Q^*{}^3$.


\begin{remark}
The fixed field of $\sigma_1\sigma_2$ is $K(\zeta_7)=\Q(\zeta_{21})$.
One may check that this is the field of definition of the full set of
$7$-isogenies of $E_b$: this is consistent with $\sigma_1\sigma_2$
having trivial image in $\PGL(2,\F_7)$.
\end{remark}

\subsection{Proof: special case}

Now we take $u=-7^3$ so the sextic twist by~$u$ is just the quadratic
twist by $-7$.  We fix $\gamma^{1/6}$ and $\gamma'^{1/6}$ with
$\tau(\gamma^{1/6})=\gamma'^{1/6}$ as before.

Since $\gamma\gamma'\in\Q^*{}^3$, any $\sigma\in\Gal(L/K)$
maps~$\gamma^{1/6}$ to $\zeta_6^r\gamma^{1/6}$ and~$\gamma'^{1/6}$ to
$\zeta_6^s\gamma^{1/6}$ where $(r,s)\in(\Z/6\Z)^2$ satisfy
$r+s\equiv0\pmod3$.  (Here $\zeta_6=-w$.) So $\Gal(L/K)$ is isomorphic
to a subgroup of index~$3$ in~$(\Z/6\Z)^2$.  As generators we may take
$\sigma_1$ of order~$6$ mapping to $(1,-1)$, and $\sigma_2$ of
order~$2$ mapping to $(0,3)$.  Then the computations carried out for
the generic case give
\[
   \rho_{E_b,7}(\sigma_1) = \begin{pmatrix}3&0\\0&3   \end{pmatrix},
\]
and
\[
   \rho_{E_b,7}(\sigma_2) = \begin{pmatrix}1&0\\0&-1   \end{pmatrix}.
\]

The twist map takes $(x,y)\mapsto(-7x,\sqrt{-7}^3y)$ and we find that
all three of $\sigma_1$, $\sigma_2$ and~$\tau$ map $\sqrt{-7}$ to
$-\sqrt{-7}$.  For this one may use the classical formula
\[
   \sqrt{-7} = \sum_{k\pmod7}\legendre{k}{7}\zeta_7^k.
\]
The same definition of~$\phi$ as in the generic case gives a
symplectic Galois isomorphism here, completing the proof.

\begin{remark}
The same method can be used to show that $E_b$ and $E_{-27b}$ have
antisymplectically isomorphic Galois representations.  However this is
more easily seen by noting that these curves are $3$-isogenous; since
$3$ is a non-quadratic residue of~$7$, a $3$-isogeny between them
induces an anti-symplectic isomorphism between their $7$-torsion modules. Actually, these curves 
are twists by~$-3$, and this also follows 
from Theorem~\ref{T:Cartan} and Remark~\ref{R:CM}. 
\end{remark}

%\begin{remark} Over a field where $-3$ is a square, 
%the curves $E_b$ and $E_{-27b}$ in the previous remark are even isomorphic, and the $3$-isogeny is the endomorphism $\pm\r3$. 
%\end{remark}









\section{Summary of congruences in LMFDB and examples}
\label{S:summary}

\begin{example}
Consider the set of six elliptic curves
\[\{\lmfdbec{9225}{a}{1}, \lmfdbec{9225}{e}{1}, \lmfdbec{225}{a}{1},
\lmfdbec{225}{a}{2}, \lmfdbec{11025}{c}{1}, \lmfdbec{11025}{c}{2}\}\]
which form four
complete isogeny classes.  All have isomorphic mod~7 representations
with image the normaliser of a split Cartan subgroup.  The last four
curves all have $j$-invariant~$0$ and CM by $-3$.  The first two are
$-3$-twists of each other.

The general methods of Step~4 of the section~3 split this set into two
subsets:
\[
  \{\lmfdbec{9225}{a}{1}, \lmfdbec{225}{a}{1},
  \lmfdbec{11025}{c}{1}\},\qquad \{\lmfdbec{9225}{e}{1},
  \lmfdbec{225}{a}{2}, \lmfdbec{11025}{c}{2}\}
\]
Curves $\lmfdbec{9225}{a}{1}$ and $\lmfdbec{9225}{e}{1}$ give a non-CM
example of  Theorem~\ref{T:Cartan}.  Curves  $\lmfdbec{225}{a}{1}$ and
$\lmfdbec{11025}{c}{1}$ are sextic (but  not quadratic or cubic) twists
and illustrate Theorem~\ref{T:j=0}.
\end{example}


 
\begin{thebibliography}{999}

\bibitem{BDMTV}
Jennifer~S. Balakrishnan, Netan Dogra, J.~Steffen M\"uller, Jan Tuitman, and
  Jan Vonk.
\newblock Explicit {C}habauty-{K}im for the split Cartan modular curve of level 13, Annals of Math. (to appear).

\bibitem{BDMTV-S4}
Jennifer~S. Balakrishnan, Netan Dogra, J.~Steffen M\"uller, Jan Tuitman, and
  Jan Vonk.
\newblock Personal communication.

\bibitem{BarinderCrem} B.\ Banwait and J.\ Cremona, 
{\em Tetrahedral Elliptic Curves and the local-to-global principle for Isogenies}
Algebra \& Number Theory {\bf 8} (2014), no. 5, 1201--1229.

\bibitem{Billerey17} N.~Billerey,
  {\em On some remarkable congruences between two elliptic curves},
  \url{https://arxiv.org/abs/1605.09205}.
  
\bibitem{BPR2013}
Yuri Bilu, Pierre Parent, and Marusia Rebolledo.
\newblock Rational points on {$X^+_0(p^r)$}.
\newblock {\em Ann. Inst. Fourier (Grenoble)}, 63(3):957--984, 2013.

\bibitem{AMEC}
J.~E. Cremona.
\newblock {\em Algorithms for modular elliptic curves}.
\newblock Cambridge University Press, Cambridge, second edition, 1997.

\bibitem{DahmenPhD} S.\ Dahmen,
 {\em Classical and modular methods applied to Diophantine equations}, 
 PhD thesis, Utrecht University, 2008. Available at \\
 \url{https://dspace.library.uu.nl/handle/1874/29640}


\bibitem{FKSym} N.\ Freitas and A.\ Kraus,
{\em On the symplectic type of isomorphisms of the $p$-torsion of elliptic curves}, Preprint

\bibitem{lmfdb} The {LMFDB Collaboration},
{\em The L-functions and Modular Forms Database}, \\
\url{http://www.lmfdb.org}, 2013.

\bibitem{Fisher} T.\ Fisher,
{\em On families of $7$ and $11$-congruent elliptic curves}, 
LMS J.\ Comput.\ Math.\ {\bf 17} (2014), no. 1, 536--564.

\bibitem{FisherList} T.\ Fisher,
{\em A table of $11$-congruent elliptic curves over the rationals}, \\
\url{https://www.dpmms.cam.ac.uk/~taf1000/papers/congr-11}

\bibitem{GL}
Enrique Gonz\'{a}lez-Jim\'{e}nez and \'{A}lvaro Lozano-Robledo.
\newblock Elliptic curves with abelian division fields.
\newblock {\em Math. Z.}, 283(3-4):835--859, 2016.

\bibitem{Halberstadt-Kraus-YE7}
Emmanuel Halberstadt and Alain Kraus, \emph{On the modular curves {$Y_E(7)$}},
  Math. Comp. \textbf{69} (2000), no.~231, 1193--1206. \MR{1651758}

\bibitem{Halberstadt-Kraus-XE7}
\bysame, \emph{Sur la courbe modulaire {$X_E(7)$}}, Experiment. Math.
  \textbf{12} (2003), no.~1, 27--40. \MR{2002672}
  
\bibitem{KO}
A.~Kraus and J.~Oesterl\'{e}.
\newblock Sur une question de {B}. {M}azur.
\newblock {\em Math. Ann.}, 293(2):259--275, 1992.

\bibitem{magma}
Wieb Bosma, John Cannon, and Catherine Playoust.
\newblock The {M}agma algebra system. {I}. {T}he user language.
\newblock {\em J. Symbolic Comput.}, 24(3-4):235--265, 1997.
\newblock Computational algebra and number theory (London, 1993).

\bibitem{PSS}
Bjorn Poonen, Edward~F. Schaefer, and Michael Stoll.
\newblock Twists of {$X(7)$} and primitive solutions to {$x^2+y^3=z^7$}.
\newblock {\em Duke Math. J.}, 137(1):103--158, 2007.

\bibitem{sage}
W.\thinspace{}A. Stein et~al.
\newblock {\em {S}age {M}athematics {S}oftware ({V}ersion 8.7)}.
\newblock The Sage Development Team, 2019.
\newblock {\tt http://www.sagemath.org}.

\bibitem{Sutherland}
Andrew V. Sutherland.
\newblock Computing images of Galois representations attached to elliptic curves.
\newblock {\em Forum of Mathematics}, Sigma {\bf 4} (2016), e4, 79 pp.

    
\begin{comment}
 
\bibitem{AnniSiksek} S.\ Anni and S.\ Siksek,
{\em Modular elliptic curves over real abelian fields and the generalized {F}ermat equation $x^{2\ell} + y^{2m}=z^p$}, Algebra \& Number Theory {\bf 10} (2016), no.6, 1147--1172

%\bibitem{bggt14}
%T. Barnet-Lamb, T. Gee, D. Geraghty, and R. Taylor,
%\emph{Potential automorphy and change of weight}, Ann. of Math. (2)
 % \textbf{179} (2014), no.~2, 501--609. \MR{3152941}

\bibitem{BennetSkinner} M.\ A.\ Bennett and C.\ M.\ Skinner,
{\em Ternary Diophantine equations via Galois representations and modular forms}, Canad.\ J.\ Math.\ {\bf 56} (2004), no. 1, 23--54.
 
%\bibitem{Bill} N. Billerey,
%{\em {\'E}quations de Fermat de type $(5,5,p)$},
%Bull.\ Austral.\ Math.\ Soc. {\bf 76} (2007), no. 2, 161--194.

%\bibitem{BD} N. Billerey and L.\ Dieulefait,
%{\em Solving Fermat-type equations $x^5 + y^5=d z^p$},
%Mathematics of Computation {\bf 79} (2010), no. 286, 535--544.

\bibitem{programs} N. Billerey, I. Chen, L. Demb\'el\'e, L. Dieulefait, and N. Freitas, 
{\em Supporting {{\Magma}} program files for this paper},
\url{http://math.univ-bpclermont.fr/~billerey/Research/BCDDF/}

\bibitem{BCDF} N. Billerey, I. Chen. L. Dieulefait, and N. Freitas, 
{\em A multi-Frey approach to Fermat equations of signature $(r,r,p)$},
Transactions of AMS (to appear).

\bibitem{BD14} C.~Breuil, and F.~Diamond,
{\em Formes modulaires de Hilbert modulo $p$ et valeurs d'extensions entre caract\`eres galoisiens.}
Ann. Sci. \'Ec. Norm. Sup\'er. (4) {\bf 47} (2014), no. 5, 905--974.

\bibitem{BMSI} Y.\ Bugeaud, M.\ Mignotte and S.\ Siksek
{\em A multi-Frey approach to some multi-parameter families of Diophantine equations},
Canadian Journal of Mathematics {\bf 60} (2008), 491-519.


\bibitem{magma}
W. Bosma, J. Cannon, and C. Playoust.
\newblock The {M}agma algebra system. {I}. {T}he user language.
\newblock {\em J. Symbolic Comput.}, 24(3-4):235--265, 1997.
\newblock Computational algebra and number theory (London, 1993).


%\bibitem{BreuilDiamond} C.\ Breuil and F.\ Diamond
%{\em Formes modulaires de Hilbert modulo $p$ et valeurs d'extensions galoisiennes},
%Annales Scientifiques de l'\'{E}cole Normale Sup\'{e}rieure, to appear.


%\bibitem{bdj10} K. Buzzard, F. Diamond, and F. Jarvis,
%{\em On Serre's conjecture for mod $\ell$ Galois representations over totally real fields.} 
%Duke Math. J. {\bf 155} (2010), no. 1, 105--161.

\bibitem{BH06} C.\ J.\ Bushnell, G.\ Henniart, 
{\em The local Langlands conjecture for $\GL(2)$.} 
{\it Grundlehren der Mathematischen Wissenschaften} {\bf 335},
Springer-Verlag, Berlin, 2006. xii+347 pp.


\bibitem{Cali} \'E.\ Cali, 
{\em D{\'e}faut de semi-stabilit{\'e} des courbes elliptiques dans le cas non ramifi{\'e}}, 
Canad.\ J.\ Math.\ {\bf 56} (2004), no 4, 673--698.

\bibitem{car86}  H. Carayol, 
{\em Sur les repr\'esentations $l$-adiques associ\'ees aux formes modulaires de Hilbert}. 
Ann. Sci. \'Ecole Norm. Sup. (4) {\bf 19} (1986), no. 3, 409--468.

%\bibitem{cli37}
%A. H. Clifford, {\em Representations induced in an invariant subgroup}, Ann.
%of Math. {\bf 38} (1937), 533--550.

\bibitem{cmsv} E. Costa, N. Mascot, J. Sijsling, J. Voight,
{\em Rigorous computation of the endomorphism ring of a Jacobian}, preprint.
Available at \url{https://arxiv.org/pdf/1705.09248.pdf}. 

\bibitem{DahmenSiksek} S. R. Dahmen, and S. Siksek,
{\em Perfect powers expressible as sums of two fifth or seventh powers.} 
Acta Arith. {\bf 164} (2014), no. 1, 65--100. 

\bibitem{DarmonDuke} H.\ Darmon,
{\em Rigid local systems, {H}ilbert modular forms, and {F}ermat's last theorem}, 
Duke Math.\ J.\ {\bf 102} (2000), no 3, 413--449.

\bibitem{DV13} L.~Demb\'el\'e, Lassina, and J.~Voight, 
{\em Explicit methods for Hilbert modular forms.} Elliptic curves, Hilbert modular forms and Galois deformations, 
135--198, Adv. Courses Math. CRM Barcelona, Birkh\"auser/Springer, Basel, 2013.

%\bibitem{DDT}
%H. Darmon, F. Diamond, and R. Taylor, 
%{\em Fermat's last theorem}. Elliptic curves, modular forms and Fermat's last theorem (Hong Kong, %1993), 2--140, 
%Int. Press, Cambridge, MA, 1997.

\bibitem{dk16}
L. Demb\'el\'e, and A. Kumar, 
{\em Examples of abelian surfaces with everywhere good reduction.} Math. Ann. {\bf 364} (2016), no. 3-4, 1365--1392.

%\bibitem{dk17} 
%L. Demb\'el\'e, and A. Kumar, 
%{\em On the existence of abelian surfaces with everywhere good reduction}, in preparation.

 
\bibitem{dia95} F. Diamond, 
{\em An extension of Wiles' results.} 
Modular forms and Fermat's last theorem (Boston, MA, 1995), 475--489, Springer, New York, 1997. 
 
%\bibitem{DF1} L.\ Dieulefait and N. Freitas,
%{\em The Fermat-type equations $x^5 + y^5 = 2z^p$ or $3z^p$ solved through $\Q$-curves},
%Mathematics of Computation {\bf 83} (2014), no. 286, 917--933.

%\bibitem{DFV} L.\ Demb\'el\'e, N.\ Freitas, and J.\ Voight,
%{\em On Galois inertial types of elliptic curves over $\Q_\ell$}, preprint.

\bibitem{BP} J.\  Burgos Gil and A.\ Pacetti, 
{\em Hecke and Sturm bounds for Hilbert modular forms over real quadratic fields.}
Math. Comp. {\bf 86} (2017), no. 306, 1949--1978. 

\bibitem{DD17} T. Dokchitser, C. Doris
{\em $3$-torsion and conductor of genus 2 curves}, preprint.
Available \url{https://arxiv.org/pdf/1706.06162.pdf}. 

\bibitem{Dor17} C. Doris, Package for computing the conductor or genus $2$ curves.
Available at \url{https://cjdoris.github.io/Genus2Conductor/\#installation}

\bibitem{ek14}
N. Elkies, and A. Kumar, 
{\em $K3$ surfaces and equations for Hilbert modular surfaces.}
Algebra Number Theory {\bf 8} (2014), no. 10, 2297--2411.
 
%\bibitem{Ell} J.\ Ellenberg,
%{\em Galois representations attached to $\Q$-curves and the Generalized Fermat equation $A^4 + B^2 = %C^p$}, Amer.\ J.\ Math.\ {\bf 126} (2016), no. 4, 763--787.

\bibitem{ell05} J. Ellenberg, {\em Serre's conjecture over $\F_9$},
Ann. of Math. (2) {\bf 161} (2005), no. 3, 1111--1142.


\bibitem{feit} W.\ Feit, 
{\em The Representation Theory of Finite Groups},
North-Holland, Amsterdam-New York-Oxford, 1982.

%\bibitem{F} N. Freitas,
%{\em Recipes for Fermat-type equations of the form $x^r + y^r = Cz^p$},
%Math.\ Z.\ {\bf 279} (2015), no. 3-4, 605--639.

\bibitem{F33p} N. Freitas,
{\em On the Fermat-type equation $x^3 + y^3 = z^p$},
Commentarii Mathematici Helvetici {\bf 91} (2016), 295--304.


%\bibitem{FS} Freitas, Nuno and Siksek, Samir,
%{\em Criteria for irreducibility of {${\rm mod}\, p$} representations of {F}rey curves}, J. Th\'eor. Nombres Bordeaux, 27, (2015), no. 1, 67--76.

\bibitem{FLHS} N. Freitas, B. Le Hung, S. Siksek,
{\em Elliptic Curves over Real Quadratic Fields are Modular},
Inventiones Mathematicae {\bf 201} (2015), no. 1, 159--206.


\bibitem{GV11}
M.~Greenberg, and J.~Voight, 
{\em Computing systems of Hecke eigenvalues associated to Hilbert modular forms.}
Math. Comp. {\bf 80} (2011), no. 274, 1071--1092.

%\bibitem{FNS23n} N.\ Freitas, B.\ Naskr{\k e}cki and M.\ Stoll,
%{\em The generalized Fermat equation with exponents $2,3,n$.} (preprint)
%\url{http://www.math.ubc.ca/~nuno/preprint3.pdf}

%\bibitem{Fuj} K.\ Fujiwara,
%{\em Level optimisation in the totally real case},
%{\tt arXiv:0602586v1}, 27 February 2006.

%\bibitem{Jarv} F.\ Jarvis,
%{\em Correspondences on Shimura curves and Mazur's principle at $p$},
%Pacific J. Math., {\bf 213} (2), 2004, 267--280.

\bibitem{kw09} C.~Khare, and J.-P. Wintenberger, 
{\em On Serre's conjecture for $2$-dimensional mod p representations of ${\rm Gal}(\overline{\Q}/\Q)$.} 
Ann. of Math. (2) {\bf 169} (2009), no. 1, 229--253.

\bibitem{kis09} M. Kisin, {\em Moduli of finite flat group schemes, and modularity}. 
Ann. of Math. (2) {\bf 170} (2009), no. 3, 1085--1180.

\bibitem{Kraus1990} A.\ Kraus,
{\em Sur le d\'efaut de semi-stabilit\'e des courbes elliptiques \`a r\'eduction additive},
Manuscripta Math.\ {\bf 69} (1990), no. 4, 353--385.

\bibitem{kut80} P. Kutzko, 
{\em The Langlands conjecture for $\GL_2$ of a local field.} 
Ann. of Math. (2) {\bf 112} (1980), no. 2, 381--412.

\bibitem{liu93} Q. Liu, 
{\em Courbes stables de genre 2 et leur sch\'ema de modules.}
Math. Ann. {\bf 295} (1993), no. 2, 201--222. 

\bibitem{martin} K.~Martin, 
{\em The Jacquet-Langlands correspondence, Eisenstein congruences, and integral $L$-values in weight $2$.} 
Math. Res. Lett. {\bf 24} (2017), no. 6, 1775--1795.

\bibitem{nek12} J.~Nekovar, 
\emph{{L}evel {R}aising and {A}nticyclotomic {S}elmer {G}roups for {H}ilbert {M}odular {F}orms of
{W}eight {T}wo}, Canad. J. Math. Vol. {\bf 64} (3), 2012 pp. 588--668.

%\bibitem{Raj} A.\ Rajaei,
%{\em On the levels of mod {$\ell$} Hilbert modular forms}, 
%J.\ reine angew.\ Math.\ 
%{\bf 537} (2001), 33--65.

\bibitem{ribet10}
K. Ribet, {\em Non-optimal levels of mod $\ell$ reducible Galois representations}, 
CRM Lecture notes, 2010. Available at \url{http://math.berkeley.edu/~ribet/crm.pdf}.

\bibitem{ribet} K. Ribet, {\em Abelian varieties over $\Q$ and modular forms}. 
Modular curves and abelian varieties, 241--261, Progr. Math., 224, Birkh\"auser, Basel, 2004.

\bibitem{SerreReps} J.-P.\ Serre, 
{\em Linear representations of finite groups},
Springer-Verlag, New York-Heidelberg, 1977.
Translated from the second French edition by Leonard L. Scott,
Graduate Texts in Mathematics, Vol. 42. 
 
\bibitem{ST1968} J.-P.\ Serre and J.\ Tate,
{\em Good reduction of abelian varieties},
Annals of Math.\ {\bf 88} (1968), no. 2, 492--517.

\bibitem{shi78} Goro Shimura, 
\emph{The special values of the zeta functions associated with 
{H}ilbert modular forms}, Duke Math. J. \textbf{45} (1978), no.~3, 637--679.


%\bibitem{stein} W.~Stein, {\em Modular forms, a computational approach}. 
%With an appendix by Paul E. Gunnells. Graduate Studies in Mathematics, {\bf 79}. 
%American Mathematical Society, Providence, RI, 2007. xvi+268 pp.


\bibitem{wilson98} J.\ Wilson,
{\em Curves of genus 2 with real multiplication by a square root of 5}, PhD thesis, University of Oxford, 1998.

\bibitem{yoo}H.~Yoo, {\em Non-optimal levels of a reducible mod $\ell$ modular representation}, preprint.
Available at \url{https://arxiv.org/pdf/1409.8342.pdf}.

\bibitem{tay89}
R. Taylor, 
\emph{On {G}alois representations associated to {H}ilbert modular forms}, 
Invent.\ Math.\ \textbf{98} (1989), no.~2, 265--280.
  
 \bibitem{zha01}S.~Zhang, 
 \emph{ {H}eights of {H}eegner {P}oints on {S}himura {C}urves},
Annals of Math., Second Series, Vol. {\bf 153}, No. 1 (2001), pp. 27--147.
\end{comment}
\end{thebibliography}



\end{document}
